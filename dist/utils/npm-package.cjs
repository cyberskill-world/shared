"use strict";function e(e,t,r,n,a,s,o){try{var c=e[s](o);var u=c.value}catch(e){r(e);return}if(c.done){t(u)}else{Promise.resolve(u).then(n,a)}}function t(t){return function(){var r=this,n=arguments;return new Promise(function(a,s){var o=t.apply(r,n);function c(t){e(o,a,s,c,u,"next",t)}function u(t){e(o,a,s,c,u,"throw",t)}c(undefined)})}}function r(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function n(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};var a=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}a.forEach(function(t){r(e,t,n[t])})}return e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t){n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})}r.push.apply(r,n)}return r}function s(e,t){t=t!=null?t:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(t))}else{a(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function o(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function c(e,t){var r,n,a,s,o={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]};return s={next:c(0),"throw":c(1),"return":c(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");while(o)try{if(r=1,n&&(a=s[0]&2?n["return"]:s[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;if(n=0,a)s=[s[0]&2,a.value];switch(s[0]){case 0:case 1:a=s;break;case 4:o.label++;return{value:s[1],done:false};case 5:o.label++;n=s[1];s=[0];continue;case 7:s=o.ops.pop();o.trys.pop();continue;default:if(!(a=o.trys,a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){o=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(s[0]===6&&o.label<a[1]){o.label=a[1];a=s;break}if(a&&o.label<a[2]){o.label=a[2];o.ops.push(s);break}if(a[2])o.ops.pop();o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e];n=0}finally{r=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}}var u=Object.create;var i=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var d=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var g=function(e,t){for(var r in t)i(e,r,{get:t[r],enumerable:!0})},h=function(e,t,r,n){var a=true,s=false,c=undefined;if(t&&(typeof t==="undefined"?"undefined":o(t))=="object"||typeof t=="function")try{var u=function(){var a=g.value;!p.call(e,a)&&a!==r&&i(e,a,{get:function(){return t[a]},enumerable:!(n=l(t,a))||n.enumerable})};for(var d=f(t)[Symbol.iterator](),g;!(a=(g=d.next()).done);a=true)u()}catch(e){s=true;c=e}finally{try{if(!a&&d.return!=null){d.return()}}finally{if(s){throw c}}}return e};var v=function(e,t,r){return r=e!=null?u(d(e)):{},h(t||!e||!e.__esModule?i(r,"default",{value:e,enumerable:!0}):r,e)},y=function(e){return h(i({},"__esModule",{value:!0}),e)};var b={};g(b,{getLatestPackageVersion:function(){return X},isCurrentProject:function(){return eo},isPackageOutdated:function(){return er},updatePackage:function(){return ea}});module.exports=y(b);var m=v(require("node-fetch"),1),w=v(require("fs"),1),O=v(require("path"),1),S=v(require("process"),1);var k=v(require("chalk"),1),P=require("child_process"),j=v(require("process"),1),E=v(require("util"),1);var x=v(require("localforage"),1),I=v(require("node-persist"),1),_=v(require("os"),1),q=v(require("path"),1),D=v(require("process"),1),F=(typeof window==="undefined"?"undefined":o(window))<"u",N=D.default.env.CYBERSKILL_STORAGE_DIR||q.default.join(_.default.homedir(),".cyberskill-storage");function C(){return L.apply(this,arguments)}function L(){L=t(function(){var e;return c(this,function(t){switch(t.label){case 0:e=!F&&!I.default.defaultInstance;if(!e)return[3,2];return[4,I.default.init({dir:N,stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:e=t.sent();t.label=2;case 2:e;return[2]}})});return L.apply(this,arguments)}var M={get:function e(e){return t(function(){var t,r,n;return c(this,function(a){switch(a.label){case 0:a.trys.push([0,6,,7]);if(!F)return[3,2];return[4,x.default.getItem(e)];case 1:r=a.sent();return[3,5];case 2:return[4,C()];case 3:a.sent();return[4,I.default.getItem(e)];case 4:r=(t=a.sent())!==null&&t!==void 0?t:null;a.label=5;case 5:return[2,r];case 6:n=a.sent();return[2,(console.error('❌ [Storage:get] Error getting key "'.concat(e,'":'),n),null)];case 7:return[2]}})})()},set:function e(e,r){return t(function(){var t,n;return c(this,function(a){switch(a.label){case 0:a.trys.push([0,6,,7]);if(!F)return[3,2];return[4,x.default.setItem(e,r)];case 1:t=a.sent();return[3,5];case 2:return[4,C()];case 3:a.sent();return[4,I.default.setItem(e,r)];case 4:t=a.sent();a.label=5;case 5:t;return[3,7];case 6:n=a.sent();console.error('❌ [Storage:set] Error setting key "'.concat(e,'":'),n);return[3,7];case 7:return[2]}})})()},remove:function e(e){return t(function(){var t,r;return c(this,function(n){switch(n.label){case 0:n.trys.push([0,6,,7]);if(!F)return[3,2];return[4,x.default.removeItem(e)];case 1:t=n.sent();return[3,5];case 2:return[4,C()];case 3:n.sent();return[4,I.default.removeItem(e)];case 4:t=n.sent();n.label=5;case 5:t;return[3,7];case 6:r=n.sent();console.error('❌ [Storage:remove] Error removing key "'.concat(e,'":'),r);return[3,7];case 7:return[2]}})})()},keys:function e(){return t(function(){var e,t;return c(this,function(r){switch(r.label){case 0:r.trys.push([0,6,,7]);if(!F)return[3,2];return[4,x.default.keys()];case 1:e=r.sent();return[3,5];case 2:return[4,C()];case 3:r.sent();return[4,I.default.keys()];case 4:e=r.sent()||[];r.label=5;case 5:return[2,e];case 6:t=r.sent();return[2,(console.error("❌ [Storage:keys] Error getting keys:",t),[])];case 7:return[2]}})})()},values:function e(){return t(function(){var e,t;return c(this,function(r){switch(r.label){case 0:r.trys.push([0,7,,8]);if(!F)return[3,3];return[4,x.default.keys()];case 1:e=r.sent();return[4,Promise.all(e.map(function(e){return x.default.getItem(e)}))];case 2:return[2,r.sent().filter(function(e){return e!==null})];case 3:return[4,C()];case 4:r.sent();return[4,I.default.values()];case 5:return[2,r.sent()];case 6:return[3,8];case 7:t=r.sent();return[2,(console.error("❌ [Storage:values] Error getting values:",t),[])];case 8:return[2]}})})()},entries:function e(){return t(function(){var e,r,n,a;return c(this,function(s){switch(s.label){case 0:s.trys.push([0,8,,9]);if(!F)return[3,3];return[4,x.default.keys()];case 1:e=s.sent();return[4,Promise.all(e.map(/*#__PURE__*/function(){var e=t(function(e){var t;return c(this,function(r){switch(r.label){case 0:return[4,x.default.getItem(e)];case 1:t=r.sent();return[2,t!==null?[e,t]:null]}})});return function(t){return e.apply(this,arguments)}}()))];case 2:return[2,s.sent().filter(function(e){return e!==null})];case 3:return[4,C()];case 4:s.sent();return[4,I.default.keys()];case 5:r=s.sent();return[4,I.default.values()];case 6:n=s.sent();return[2,r.map(function(e,t){return[e,n[t]]})];case 7:return[3,9];case 8:a=s.sent();return[2,(console.error("❌ [Storage:entries] Error getting entries:",a),[])];case 9:return[2]}})})()},clear:function e(){return t(function(){var e,t;return c(this,function(r){switch(r.label){case 0:r.trys.push([0,6,,7]);if(!F)return[3,2];return[4,x.default.clear()];case 1:e=r.sent();return[3,5];case 2:return[4,C()];case 3:r.sent();return[4,I.default.clear()];case 4:e=r.sent();r.label=5;case 5:e;return[3,7];case 6:t=r.sent();console.error("❌ [Storage:clear] Error clearing storage:",t);return[3,7];case 7:return[2]}})})()},length:function e(){return t(function(){var e,t;return c(this,function(r){switch(r.label){case 0:r.trys.push([0,6,,7]);if(!F)return[3,2];return[4,x.default.length()];case 1:e=r.sent();return[3,5];case 2:return[4,C()];case 3:r.sent();return[4,I.default.keys()];case 4:e=r.sent().length;r.label=5;case 5:return[2,e];case 6:t=r.sent();return[2,(console.error("❌ [Storage:length] Error getting storage length:",t),0)];case 7:return[2]}})})()}};var J=function(e){return"error_list:".concat(e)},T=24*60*60*1e3;function R(e){return U.apply(this,arguments)}function U(){U=t(function(e){var t,r,n;return c(this,function(a){switch(a.label){case 0:if(!e.length)return[2];t=Date.now(),r=J(t);a.label=1;case 1:a.trys.push([1,3,,4]);return[4,M.set(r,{errors:e,timestamp:t})];case 2:a.sent(),console.log("✅ Saved ".concat(e.length," errors to storage with key: ").concat(r));return[3,4];case 3:n=a.sent();console.error("❌ Failed to save errors: ".concat(n.message));return[3,4];case 4:return[2]}})});return U.apply(this,arguments)}var G=E.promisify(P.exec),V=k.default,$=V.gray,A=V.white,B=[];function K(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";var r=new Date().toLocaleString();console.log("".concat(t," [").concat(r,"] ").concat(A(e)))}function W(e){var t=/^\s*(\d+):(\d+)\s+(error|warning)\s+(\S+)\s+(\S+)$/,r=/^(.+?)\((\d+),(\d+)\):\s+(error|warning)\s+TS\d+:\s+(\S.+)$/,n=/^✖\s+(.*?)\s+\[(.*?)\]$/,a=[],s="";e.split("\n").forEach(function(e){if(e.startsWith("/"))s=e.trim();else{var o=t.exec(e);if(o&&s)B.push({file:s,position:"".concat(o[1],":").concat(o[2]),type:o[3]==="error"?"error":"warning",message:o[4].trim(),rule:o[5].trim()});else{var c=r.exec(e);if(c)B.push({file:c[1],position:"".concat(c[2],":").concat(c[3]),type:c[4],message:c[5].trim()});else{var u=n.exec(e);u?B.push({file:"commitlint",type:"error",message:u[1].trim(),rule:u[2].trim()}):a.push(e.trim())}}}}),a.length>0&&(console.log($("Unmatched lines:")),a.forEach(function(e){return console.info(e)}))}function Y(e){try{JSON.parse(e).forEach(function(e){var t=e.filePath,r=e.messages;r.forEach(function(e){var r=e.severity,n=e.line,a=e.column,s=e.ruleId,o=e.message;B.push({type:r===2?"error":"warning",file:t,position:"".concat(n,":").concat(a),rule:s,message:o})})})}catch(t){W(e)}}function z(e,t){return H.apply(this,arguments)}function H(){H=t(function(e,t){var r,n,a,s,o,u,i;var l=arguments;return c(this,function(c){switch(c.label){case 0:r=l.length>2&&l[2]!==void 0?l[2]:Y;K(t);n=new AbortController;j.default.on("SIGINT",function(){console.log("Terminating process..."),n.abort(),j.default.exit()});c.label=1;case 1:c.trys.push([1,5,,6]);return[4,G(e,{maxBuffer:0x6400000,signal:n.signal})];case 2:a=c.sent(),s=a.stdout,o=a.stderr;[s,o].forEach(function(e){return e&&r(e)});u=B.length;if(!u)return[3,4];return[4,R(B)];case 3:u=c.sent();c.label=4;case 4:u;return[3,6];case 5:i=c.sent();console.error("Command failed: ".concat(i.message));return[3,6];case 6:return[2]}})});return H.apply(this,arguments)}var Q=24*60*60*1e3;function X(e){return Z.apply(this,arguments)}function Z(){Z=t(function(e){var t,r,n,a,s,o,u,i,l,f;var d=arguments;return c(this,function(c){switch(c.label){case 0:t=d.length>1&&d[1]!==void 0?d[1]:!1;r="npm_version:".concat(e),n="npm_metadata:".concat(e);return[4,M.get(r)];case 1:a=c.sent();return[4,M.get(n)];case 2:s=c.sent(),o=a&&Date.now()-a.timestamp<Q;if(!t&&o)return[2,(console.log("Using cached version for ".concat(e,": ").concat(a.version)),a.version)];u={};(s===null||s===void 0?void 0:s.etag)&&(u["If-None-Match"]=s.etag),(s===null||s===void 0?void 0:s.lastModified)&&(u["If-Modified-Since"]=s.lastModified);c.label=3;case 3:c.trys.push([3,8,,9]);console.log("Fetching latest version for ".concat(e,"..."));return[4,(0,m.default)("https://registry.npmjs.org/".concat(e,"/latest"),{headers:u})];case 4:i=c.sent();if(i.status===304&&a)return[2,(console.log("Cache is still valid for ".concat(e,": ").concat(a.version)),a.version)];if(!i.ok)throw new Error("Failed to fetch latest version: ".concat(i.statusText));return[4,i.json()];case 5:l=c.sent().version;return[4,M.set(r,{version:l,timestamp:Date.now()})];case 6:c.sent();return[4,M.set(n,{etag:i.headers.get("ETag")||void 0,lastModified:i.headers.get("Last-Modified")||void 0})];case 7:return[2,(c.sent(),console.log("Cached latest version for ".concat(e,": ").concat(l)),l)];case 8:f=c.sent();if(console.error("Error fetching latest version for ".concat(e,": ").concat(f.message)),a)return[2,(console.warn("Falling back to cached version for ".concat(e,": ").concat(a.version)),a.version)];throw f;case 9:return[2]}})});return Z.apply(this,arguments)}function ee(e){return O.default.join(S.default.cwd(),"node_modules",e,"package.json")}function et(){return O.default.join(S.default.cwd(),"package.json")}function er(e){return en.apply(this,arguments)}function en(){en=t(function(e){var t,r,n,a,s;var o=arguments;return c(this,function(c){switch(c.label){case 0:t=o.length>1&&o[1]!==void 0?o[1]:!0;c.label=1;case 1:c.trys.push([1,3,,4]);r=ee(e);if(!w.default.existsSync(r))return[2,(console.log("".concat(e," is not installed.")),!0)];n=JSON.parse(w.default.readFileSync(r,"utf-8")).version;return[4,X(e,t)];case 2:a=c.sent();return[2,(console.log("Installed version of ".concat(e,": ").concat(n)),console.log("Latest version of ".concat(e,": ").concat(a)),n!==a)];case 3:s=c.sent();return[2,(console.warn("Failed to check version for ".concat(e,": ").concat(s.message)),!0)];case 4:return[2]}})});return en.apply(this,arguments)}function ea(e){return es.apply(this,arguments)}function es(){es=t(function(e){var t,a,o,u;return c(this,function(c){switch(c.label){case 0:c.trys.push([0,4,,5]);return[4,X(e,!0)];case 1:t=c.sent(),a=et(),o=JSON.parse(w.default.readFileSync(a,"utf-8"));o.dependencies=s(n({},o.dependencies),r({},e,t)),w.default.writeFileSync(a,JSON.stringify(o,null,2)),console.log("Updated ".concat(e," to version ").concat(t));return[4,z("npm i -f","Installing all dependencies with updated ".concat(e,"..."))];case 2:c.sent();return[4,z("npm run lint:fix","Fixing lint issues for ".concat(e,"..."))];case 3:c.sent(),console.log("".concat(e," updated successfully."));return[3,5];case 4:u=c.sent();throw console.error("Failed to update ".concat(e,": ").concat(u.message)),u;case 5:return[2]}})});return es.apply(this,arguments)}function eo(e,t){try{var r=O.default.join(e,"package.json");return w.default.existsSync(r)?JSON.parse(w.default.readFileSync(r,"utf-8")).name===t:!1}catch(e){return console.error("Error reading package.json: ".concat(e.message)),!1}}0&&(module.exports={getLatestPackageVersion:getLatestPackageVersion,isCurrentProject:isCurrentProject,isPackageOutdated:isPackageOutdated,updatePackage:updatePackage});