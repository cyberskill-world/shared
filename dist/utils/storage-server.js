function n(n,t){if(t==null||t>n.length)t=n.length;for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function t(n){if(Array.isArray(n))return n}function r(t){if(Array.isArray(t))return n(t)}function e(n,t,r,e,o,c,a){try{var i=n[c](a);var s=i.value}catch(n){r(n);return}if(i.done){t(s)}else{Promise.resolve(s).then(e,o)}}function o(n){return function(){var t=this,r=arguments;return new Promise(function(o,c){var a=n.apply(t,r);function i(n){e(a,o,c,i,s,"next",n)}function s(n){e(a,o,c,i,s,"throw",n)}i(undefined)})}}function c(n){if(typeof Symbol!=="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function a(n,t){var r=n==null?null:typeof Symbol!=="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(r==null)return;var e=[];var o=true;var c=false;var a,i;try{for(r=r.call(n);!(o=(a=r.next()).done);o=true){e.push(a.value);if(t&&e.length===t)break}}catch(n){c=true;i=n}finally{try{if(!o&&r["return"]!=null)r["return"]()}finally{if(c)throw i}}return e}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(n,r){return t(n)||a(n,r)||p(n,r)||i()}function l(n){return r(n)||c(n)||p(n)||s()}function f(n){"@swc/helpers - typeof";return n&&typeof Symbol!=="undefined"&&n.constructor===Symbol?"symbol":typeof n}function p(t,r){if(!t)return;if(typeof t==="string")return n(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor)e=t.constructor.name;if(e==="Map"||e==="Set")return Array.from(e);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return n(t,r)}function d(n,t){var r,e,o,c,a={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),"throw":i(1),"return":i(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function i(n){return function(t){return s([n,t])}}function s(c){if(r)throw new TypeError("Generator is already executing.");while(a)try{if(r=1,e&&(o=c[0]&2?e["return"]:c[0]?e["throw"]||((o=e["return"])&&o.call(e),0):e.next)&&!(o=o.call(e,c[1])).done)return o;if(e=0,o)c=[c[0]&2,o.value];switch(c[0]){case 0:case 1:o=c;break;case 4:a.label++;return{value:c[1],done:false};case 5:a.label++;e=c[1];c=[0];continue;case 7:c=a.ops.pop();a.trys.pop();continue;default:if(!(o=a.trys,o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1];o=c;break}if(o&&a.label<o[2]){a.label=o[2];a.ops.push(c);break}if(o[2])a.ops.pop();a.trys.pop();continue}c=t.call(n,a)}catch(n){c=[6,n];e=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}import m from"node-persist";import y from"node:os";import I from"node:process";import E from"node:process";import g from"boxen";import S from"chalk";import{exec as _}from"node:child_process";import h from"node:process";import*as T from"node:util";import v from"node-fetch";import*as O from"node:path";function b(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++){t[r]=arguments[r]}var e;return(e=O).resolve.apply(e,[x].concat(l(t)))}function A(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++){t[r]=arguments[r]}var e;return(e=O).join.apply(e,l(t))}var C=24*60*60*1e3;var N=h.env.DEBUG==="true",L=T.promisify(_),w=S.gray,G=S.blue;function k(n){return{raw:!0,cmd:n}}function R(n,t){return(t===null||t===void 0?void 0:t.isRemote)?"".concat(ns," ").concat(D," ").concat(n):(t===null||t===void 0?void 0:t.isCurrentProject)?"".concat(ns," ").concat(nc," src/cli.ts ").concat(n):"".concat(ns," ").concat(q," ").concat(n)}function M(n,t){return typeof n=="function"?R(n(t),t):(typeof n==="undefined"?"undefined":f(n))=="object"&&(n===null||n===void 0?void 0:n.raw)===!0?n.cmd:typeof n=="string"?R(n,t):n}var x=E.env.INIT_CWD||E.cwd(),D="@cyberskill/shared",K=".cyberskill-storage",P="node_modules",Y="dist",j="package.json",F="package-lock.json",B="tsconfig.json",U=".gitignore",H=".simple-git-hooks.json",J="pnpm-lock.yaml",W=".git/hooks/",X=".git/COMMIT_EDITMSG",$=A(x,P,D,Y),q="cyberskill",z="eslint",Q="vitest",V="vitest",Z="@commitlint/cli",nn="commitlint",nt="lint-staged",nr="lint-staged",ne="tsc",no="tsc",nc="tsx",na="git",ni="pnpm",ns="pnpm exec",nu="simple-git-hooks",nl="simple-git-hooks",nf="@eslint/config-inspector",np="eslint-config-inspector",nd="node-modules-inspector",nm="node-modules-inspector",ny={CYBERSKILL_DIRECTORY:$,WORKING_DIRECTORY:x,TS_CONFIG:b(B),GIT_IGNORE:b(U),GIT_HOOK:b(W),GIT_COMMIT_MSG:b(X),SIMPLE_GIT_HOOKS_JSON:b(H),PACKAGE_JSON:b(j),PACKAGE_LOCK_JSON:b(F),PNPM_LOCK_YAML:b(J),NODE_MODULES:b(P),CYBERSKILL:{LINT_STAGED_CONFIG:b("".concat($,"/configs/lint-staged/base.js")),COMMITLINT_CONFIG:b("".concat($,"/configs/commitlint/base.js")),UNIT_TEST_CONFIG:b("".concat($,"/configs/vitest/react/unit.js")),E2E_TEST_CONFIG:b("".concat($,"/configs/vitest/react/e2e.js"))}};function nI(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++){r[e-1]=arguments[e]}var o=u(r,2),c=o[0],a=o[1];switch(n){case"pnpmAddAndExec":return M(k("".concat(ni," add -D ").concat(c," && ").concat(ns," ").concat(a)));case"pnpmExec":return M(k("".concat(ns," ").concat(c," ").concat(a||"").trim()));case"raw":return M(k(c))}}var nE={SIMPLE_GIT_HOOKS:nI("pnpmAddAndExec",nu,nl),ESLINT_INSPECT:nI("pnpmAddAndExec",nf,np),NODE_MODULES_INSPECT:nI("pnpmAddAndExec",nd,nm),ESLINT_CHECK:nI("pnpmExec",z,ny.WORKING_DIRECTORY),ESLINT_FIX:nI("pnpmExec",z,"".concat(ny.WORKING_DIRECTORY," --fix")),TYPESCRIPT_CHECK:nI("pnpmAddAndExec",ne,"".concat(no," -p ").concat(ny.TS_CONFIG," --noEmit")),CONFIGURE_GIT_HOOK:nI("raw","".concat(na," config core.hooksPath ").concat(ny.GIT_HOOK)),BUILD:nI("raw","".concat(ni," run build")),STAGE_BUILD_DIRECTORY:nI("raw","".concat(na," add ").concat(Y)),PNPM_INSTALL_STANDARD:nI("raw","".concat(ni," install")),PNPM_INSTALL_LEGACY:nI("raw","".concat(ni," install --legacy-peer-deps")),PNPM_INSTALL_FORCE:nI("raw","".concat(ni," install --force")),CYBERSKILL:{TEST_UNIT:nI("pnpmAddAndExec",Q,"".concat(V," --config ").concat(ny.CYBERSKILL.UNIT_TEST_CONFIG)),TEST_E2E:nI("pnpmAddAndExec",Q,"".concat(V," --config ").concat(ny.CYBERSKILL.E2E_TEST_CONFIG)),COMMIT_LINT:nI("pnpmAddAndExec",Z,"".concat(nn," --edit ").concat(ny.GIT_COMMIT_MSG," --config ").concat(ny.CYBERSKILL.COMMITLINT_CONFIG)),LINT_STAGED:nI("pnpmAddAndExec",nt,"".concat(nr," --config ").concat(ny.CYBERSKILL.LINT_STAGED_CONFIG))}};function ng(){return I.env.CYBERSKILL_STORAGE_DIR||A(y.homedir(),K)}function nS(){return n_.apply(this,arguments)}function n_(){n_=o(function(){var n;return d(this,function(t){switch(t.label){case 0:n=m.defaultInstance;if(n)return[3,2];return[4,m.init({dir:ng(),stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:n=t.sent();t.label=2;case 2:n;return[2]}})});return n_.apply(this,arguments)}var nh={get:function n(n){return o(function(){var t,r;return d(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,nS()];case 1:e.sent();return[4,m.getItem(n)];case 2:return[2,(t=e.sent())!==null&&t!==void 0?t:null];case 3:r=e.sent();return[2,(console.error('❌ [Storage:get] Error getting key "'.concat(n,'":'),r),null)];case 4:return[2]}})})()},set:function n(n,t){return o(function(){var r;return d(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,nS()];case 1:e.sent();return[4,m.setItem(n,t)];case 2:e.sent();return[3,4];case 3:r=e.sent();console.error('❌ [Storage:set] Error setting key "'.concat(n,'":'),r);return[3,4];case 4:return[2]}})})()},remove:function n(n){return o(function(){var t;return d(this,function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,nS()];case 1:r.sent();return[4,m.removeItem(n)];case 2:r.sent();return[3,4];case 3:t=r.sent();console.error('❌ [Storage:remove] Error removing key "'.concat(n,'":'),t);return[3,4];case 4:return[2]}})})()},keys:function n(){return o(function(){var n,t;return d(this,function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,nS()];case 1:r.sent();return[4,m.keys()];case 2:n=r.sent();return[2,Array.isArray(n)?n:(console.warn("⚠️ [Storage:keys] Invalid keys response:",n),[])];case 3:t=r.sent();return[2,(console.error("❌ [Storage:keys] Error getting keys:",t),[])];case 4:return[2]}})})()},getLogLink:function n(n){return o(function(){return d(this,function(t){try{return[2,"".concat(ng()," (key: ").concat(n,")")]}catch(n){return[2,(console.error("❌ [Storage:getLogLink] Error getting log link:",n),null)]}return[2]})})()}};export{ng as getStorageDir,nS as initNodePersist,nh as storageServer};