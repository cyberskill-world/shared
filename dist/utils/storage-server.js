function t(t,r){if(r==null||r>t.length)r=t.length;for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function r(r){if(Array.isArray(r))return t(r)}function n(t,r,n,e,o,c,i){try{var a=t[c](i);var s=a.value}catch(t){n(t);return}if(a.done){r(s)}else{Promise.resolve(s).then(e,o)}}function e(t){return function(){var r=this,e=arguments;return new Promise(function(o,c){var i=t.apply(r,e);function a(t){n(i,o,c,a,s,"next",t)}function s(t){n(i,o,c,a,s,"throw",t)}a(undefined)})}}function o(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t){return r(t)||o(t)||a(t)||c()}function a(r,n){if(!r)return;if(typeof r==="string")return t(r,n);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor)e=r.constructor.name;if(e==="Map"||e==="Set")return Array.from(e);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return t(r,n)}function s(t,r){var n,e,o,c,i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return c={next:a(0),"throw":a(1),"return":a(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(t){return function(r){return s([t,r])}}function s(c){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,e&&(o=c[0]&2?e["return"]:c[0]?e["throw"]||((o=e["return"])&&o.call(e),0):e.next)&&!(o=o.call(e,c[1])).done)return o;if(e=0,o)c=[c[0]&2,o.value];switch(c[0]){case 0:case 1:o=c;break;case 4:i.label++;return{value:c[1],done:false};case 5:i.label++;e=c[1];c=[0];continue;case 7:c=i.ops.pop();i.trys.pop();continue;default:if(!(o=i.trys,o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(c[0]===6&&i.label<o[1]){i.label=o[1];o=c;break}if(o&&i.label<o[2]){i.label=o[2];i.ops.push(c);break}if(o[2])i.ops.pop();i.trys.pop();continue}c=r.call(t,i)}catch(t){c=[6,t];e=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}import u from"node-persist";import l from"node:os";import f from"node:process";import p from"node:process";import I from"boxen";import g from"chalk";import{exec as m}from"node:child_process";import _ from"node:process";import*as T from"node:util";import E from"node-fetch";import*as S from"node:path";function y(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}var e;return(e=S).resolve.apply(e,[b].concat(i(r)))}function d(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}var e;return(e=S).join.apply(e,i(r))}var h=24*60*60*1e3;var O=_.env.DEBUG==="true",v=T.promisify(m),N=g.gray,C=g.blue;function L(t){return{raw:!0,cmd:t}}var b=p.env.INIT_CWD||p.cwd(),G="@cyberskill/shared",k=".cyberskill-storage",R="node_modules",A="dist",M="package.json",w="package-lock.json",D="tsconfig.json",K=".gitignore",P=".simple-git-hooks.json",Y="pnpm-lock.yaml",F=".git/hooks/",j=".git/COMMIT_EDITMSG",B=d(b,R,G,A);var U="eslint",x="vitest",H="vitest",J="@commitlint/cli",W="commitlint",X="lint-staged",$="lint-staged",q="tsc",z="tsc";var Q="git",V="pnpm",Z="pnpm exec",tt="simple-git-hooks",tr="simple-git-hooks",tn="@eslint/config-inspector",te="eslint-config-inspector",to="node-modules-inspector",tc="node-modules-inspector",ti={CYBERSKILL_DIRECTORY:B,WORKING_DIRECTORY:b,TS_CONFIG:y(D),GIT_IGNORE:y(K),GIT_HOOK:y(F),GIT_COMMIT_MSG:y(j),SIMPLE_GIT_HOOKS_JSON:y(P),PACKAGE_JSON:y(M),PACKAGE_LOCK_JSON:y(w),PNPM_LOCK_YAML:y(Y),NODE_MODULES:y(R),CYBERSKILL:{LINT_STAGED_CONFIG:y("".concat(B,"/configs/lint-staged/base.js")),COMMITLINT_CONFIG:y("".concat(B,"/configs/commitlint/base.js")),UNIT_TEST_CONFIG:y("".concat(B,"/configs/vitest/react/unit.js")),E2E_TEST_CONFIG:y("".concat(B,"/configs/vitest/react/e2e.js"))}};function ta(t,r){return L("".concat(V," add -D ").concat(t," && ").concat(Z," ").concat(r))}function ts(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return L("".concat(Z," ").concat(t," ").concat(r).trim())}var tu={SIMPLE_GIT_HOOKS:ta(tt,tr),ESLINT_INSPECT:ta(tn,te),NODE_MODULES_INSPECT:ta(to,tc),ESLINT_CHECK:ts(U,ti.WORKING_DIRECTORY),ESLINT_FIX:ts(U,"".concat(ti.WORKING_DIRECTORY," --fix")),TYPESCRIPT_CHECK:ta(q,"".concat(z," -p ").concat(ti.TS_CONFIG," --noEmit")),CONFIGURE_GIT_HOOK:L("".concat(Q," config core.hooksPath ").concat(ti.GIT_HOOK)),BUILD:L("".concat(V," run build")),STAGE_BUILD_DIRECTORY:L("".concat(Q," add ").concat(A)),PNPM_INSTALL_STANDARD:L("".concat(V," install")),PNPM_INSTALL_LEGACY:L("".concat(V," install --legacy-peer-deps")),PNPM_INSTALL_FORCE:L("".concat(V," install --force")),CYBERSKILL:{TEST_UNIT:ta(x,"".concat(H," --config ").concat(ti.CYBERSKILL.UNIT_TEST_CONFIG)),TEST_E2E:ta(x,"".concat(H," --config ").concat(ti.CYBERSKILL.E2E_TEST_CONFIG)),COMMIT_LINT:ta(J,"".concat(W," --edit ").concat(ti.GIT_COMMIT_MSG," --config ").concat(ti.CYBERSKILL.COMMITLINT_CONFIG)),LINT_STAGED:ta(X,"".concat($," --config ").concat(ti.CYBERSKILL.LINT_STAGED_CONFIG))}};function tl(){return f.env.CYBERSKILL_STORAGE_DIR||d(l.homedir(),k)}function tf(){return tp.apply(this,arguments)}function tp(){tp=e(function(){var t;return s(this,function(r){switch(r.label){case 0:t=u.defaultInstance;if(t)return[3,2];return[4,u.init({dir:tl(),stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:t=r.sent();r.label=2;case 2:t;return[2]}})});return tp.apply(this,arguments)}var tI={get:function t(t){return e(function(){var r,n;return s(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,tf()];case 1:e.sent();return[4,u.getItem(t)];case 2:return[2,(r=e.sent())!==null&&r!==void 0?r:null];case 3:n=e.sent();return[2,(console.error('❌ [Storage:get] Error getting key "'.concat(t,'":'),n),null)];case 4:return[2]}})})()},set:function t(t,r){return e(function(){var n;return s(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,tf()];case 1:e.sent();return[4,u.setItem(t,r)];case 2:e.sent();return[3,4];case 3:n=e.sent();console.error('❌ [Storage:set] Error setting key "'.concat(t,'":'),n);return[3,4];case 4:return[2]}})})()},remove:function t(t){return e(function(){var r;return s(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,tf()];case 1:n.sent();return[4,u.removeItem(t)];case 2:n.sent();return[3,4];case 3:r=n.sent();console.error('❌ [Storage:remove] Error removing key "'.concat(t,'":'),r);return[3,4];case 4:return[2]}})})()},keys:function t(){return e(function(){var t,r;return s(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,tf()];case 1:n.sent();return[4,u.keys()];case 2:t=n.sent();return[2,Array.isArray(t)?t:(console.warn("⚠️ [Storage:keys] Invalid keys response:",t),[])];case 3:r=n.sent();return[2,(console.error("❌ [Storage:keys] Error getting keys:",r),[])];case 4:return[2]}})})()},getLogLink:function t(t){return e(function(){return s(this,function(r){try{return[2,"".concat(tl()," (key: ").concat(t,")")]}catch(t){return[2,(console.error("❌ [Storage:getLogLink] Error getting log link:",t),null)]}return[2]})})()}};export{tl as getStorageDir,tf as initNodePersist,tI as storageServer};