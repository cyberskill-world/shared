function t(t,r){if(r==null||r>t.length)r=t.length;for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function r(t){if(Array.isArray(t))return t}function n(r){if(Array.isArray(r))return t(r)}function e(t,r,n,e,o,c,a){try{var i=t[c](a);var s=i.value}catch(t){n(t);return}if(i.done){r(s)}else{Promise.resolve(s).then(e,o)}}function o(t){return function(){var r=this,n=arguments;return new Promise(function(o,c){var a=t.apply(r,n);function i(t){e(a,o,c,i,s,"next",t)}function s(t){e(a,o,c,i,s,"throw",t)}i(undefined)})}}function c(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function a(t,r){var n=t==null?null:typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n==null)return;var e=[];var o=true;var c=false;var a,i;try{for(n=n.call(t);!(o=(a=n.next()).done);o=true){e.push(a.value);if(r&&e.length===r)break}}catch(t){c=true;i=t}finally{try{if(!o&&n["return"]!=null)n["return"]()}finally{if(c)throw i}}return e}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,n){return r(t)||a(t,n)||_(t,n)||i()}function l(t){return n(t)||c(t)||_(t)||s()}function f(t){"@swc/helpers - typeof";return t&&typeof Symbol!=="undefined"&&t.constructor===Symbol?"symbol":typeof t}function _(r,n){if(!r)return;if(typeof r==="string")return t(r,n);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor)e=r.constructor.name;if(e==="Map"||e==="Set")return Array.from(e);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return t(r,n)}function p(t,r){var n,e,o,c,a={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),"throw":i(1),"return":i(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function i(t){return function(r){return s([t,r])}}function s(c){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,e&&(o=c[0]&2?e["return"]:c[0]?e["throw"]||((o=e["return"])&&o.call(e),0):e.next)&&!(o=o.call(e,c[1])).done)return o;if(e=0,o)c=[c[0]&2,o.value];switch(c[0]){case 0:case 1:o=c;break;case 4:a.label++;return{value:c[1],done:false};case 5:a.label++;e=c[1];c=[0];continue;case 7:c=a.ops.pop();a.trys.pop();continue;default:if(!(o=a.trys,o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1];o=c;break}if(o&&a.label<o[2]){a.label=o[2];a.ops.push(c);break}if(o[2])a.ops.pop();a.trys.pop();continue}c=r.call(t,a)}catch(t){c=[6,t];e=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}import E from"node-persist";import g from"node:os";import y from"node:process";import d from"node:process";import{exec as m}from"node:child_process";import*as I from"node:util";import v from"node:process";var N=v.env.DEBUG==="true";import h from"chalk";import S from"consola";import{GraphQLError as D}from"graphql";N||(S.level=4);function T(t){var r=h[t];return typeof r=="function"?r:h.green}var A={silent:S.silent,level:S.level,fatal:S.fatal,error:S.error,warn:S.warn,log:S.log,info:S.info,success:S.success,ready:S.ready,start:S.start,box:S.box,debug:S.debug,trace:S.trace,verbose:S.verbose,printBoxedLog:function t(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"red";if(!(r===null||r===void 0?void 0:r.length)){S.box(h.green(t));return}r.forEach(function(t){var r=t.file,e=t.position,o=t.rule,c=t.message;S.log("".concat(h.gray("File:")," ").concat(h.blue("".concat(r).concat(e?":".concat(e):"")))),o&&S.log("   ".concat(T(n)("Rule:")," ").concat(o)),S.log("   ".concat(T(n)("Message:")," ").concat(c))}),S.box(T(n)("".concat(t," : ").concat(r.length))),S.log(h.gray("â”€".repeat(40)))}};import C from"node-fetch";import*as b from"node:fs";function O(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}return r.every(function(t){return b.existsSync(t)})}import*as L from"node:path";function P(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}var e;return(e=L).resolve.apply(e,[K].concat(l(r)))}function M(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}var e;return(e=L).join.apply(e,l(r))}var G=I.promisify(m);function R(t){return{raw:!0,cmd:t}}function w(t,r){return(r===null||r===void 0?void 0:r.isRemote)?"".concat(t_," ").concat(j," ").concat(t):(r===null||r===void 0?void 0:r.isCurrentProject)?"".concat(t_," ").concat(tu," src/cli.ts ").concat(t):"".concat(t_," ").concat($," ").concat(t)}function k(t,r){return typeof t=="function"?w(t(r),r):(typeof t==="undefined"?"undefined":f(t))=="object"&&(t===null||t===void 0?void 0:t.raw)===!0?t.cmd:typeof t=="string"?w(t,r):t}var K=d.env.INIT_CWD||d.cwd(),j="@cyberskill/shared",x=".cyberskill-storage",Y="node_modules",F="dist",U="package.json",W="package-lock.json",X="tsconfig.json",B=".gitignore",V=".simple-git-hooks.json",H="pnpm-lock.yaml",J=".git/hooks/",q=".git/COMMIT_EDITMSG",Q=M(K,Y,j,F),$="cyberskill",z="eslint",Z="eslint",tt="vitest",tr="playwright",tn="vitest",te="@commitlint/cli",to="commitlint",tc="lint-staged",ta="lint-staged",ti="typescript",ts="tsc",tu="tsx",tl="git",tf="pnpm",t_="pnpm exec",tp="simple-git-hooks",tE="simple-git-hooks",tg="@eslint/config-inspector",ty="eslint-config-inspector",td="node-modules-inspector",tm="node-modules-inspector",tI={CYBERSKILL_DIRECTORY:Q,WORKING_DIRECTORY:K,TS_CONFIG:P(X),GIT_IGNORE:P(B),GIT_HOOK:P(J),GIT_COMMIT_MSG:P(q),SIMPLE_GIT_HOOKS_JSON:P(V),PACKAGE_JSON:P(U),PACKAGE_LOCK_JSON:P(W),PNPM_LOCK_YAML:P(H),NODE_MODULES:P(Y),CYBERSKILL:{LINT_STAGED_CONFIG:P("".concat(Q,"/configs/lint-staged/base.js")),COMMITLINT_CONFIG:P("".concat(Q,"/configs/commitlint/base.js")),UNIT_TEST_CONFIG:P("".concat(Q,"/configs/vitest/react/unit.js")),UNIT_TEST_SETUP_CONFIG:P("".concat(Q,"/configs/vitest/react/unit.setup.js")),E2E_TEST_CONFIG:P("".concat(Q,"/configs/vitest/react/e2e.js"))}};function tv(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),e=1;e<r;e++){n[e-1]=arguments[e]}var o=u(n,2),c=o[0],a=o[1],i=t==="RAW"?!0:O.apply(void 0,l(c.split(" ").map(function(t){return M(tI.NODE_MODULES,t)})));switch(t){case"PNPM_ADD_AND_EXEC":return k(R("".concat(i?"":"".concat(tf," add ").concat(c," && ")).concat(t_," ").concat(a)));case"PNPM_ADD_DEV_AND_EXEC":return k(R("".concat(i?"":"".concat(tf," add -D ").concat(c," && ")).concat(t_," ").concat(a)));case"RAW":return k(R(c))}}var tN={SIMPLE_GIT_HOOKS:tv("PNPM_ADD_DEV_AND_EXEC",tp,tE),ESLINT_INSPECT:tv("PNPM_ADD_DEV_AND_EXEC",tg,ty),NODE_MODULES_INSPECT:tv("PNPM_ADD_DEV_AND_EXEC",td,tm),ESLINT_CHECK:tv("PNPM_ADD_DEV_AND_EXEC",z,"".concat(Z," ").concat(tI.WORKING_DIRECTORY)),ESLINT_FIX:tv("PNPM_ADD_DEV_AND_EXEC",z,"".concat(Z," ").concat(tI.WORKING_DIRECTORY," --fix")),TYPESCRIPT_CHECK:tv("PNPM_ADD_AND_EXEC",ti,"".concat(ts," -p ").concat(tI.TS_CONFIG," --noEmit")),CONFIGURE_GIT_HOOK:tv("RAW","".concat(tl," config core.hooksPath ").concat(tI.GIT_HOOK)),BUILD:tv("RAW","".concat(tf," run build")),STAGE_BUILD_DIRECTORY:tv("RAW","".concat(tl," add ").concat(F)),PNPM_INSTALL_STANDARD:tv("RAW","".concat(tf," install")),PNPM_INSTALL_LEGACY:tv("RAW","".concat(tf," install --legacy-peer-deps")),PNPM_INSTALL_FORCE:tv("RAW","".concat(tf," install --force")),CYBERSKILL:{TEST_UNIT:tv("PNPM_ADD_AND_EXEC",tt,"".concat(tn," --config ").concat(tI.CYBERSKILL.UNIT_TEST_CONFIG)),TEST_E2E:tv("PNPM_ADD_AND_EXEC","".concat(tt," ").concat(tr),"".concat(tn," --config ").concat(tI.CYBERSKILL.E2E_TEST_CONFIG)),COMMIT_LINT:tv("PNPM_ADD_DEV_AND_EXEC",te,"".concat(to," --edit ").concat(tI.GIT_COMMIT_MSG," --config ").concat(tI.CYBERSKILL.COMMITLINT_CONFIG)),LINT_STAGED:tv("PNPM_ADD_DEV_AND_EXEC",tc,"".concat(ta," --config ").concat(tI.CYBERSKILL.LINT_STAGED_CONFIG))}};function th(){return y.env.CYBERSKILL_STORAGE_DIR||M(g.homedir(),x)}function tS(){return tD.apply(this,arguments)}function tD(){tD=o(function(){var t;return p(this,function(r){switch(r.label){case 0:t=E.defaultInstance;if(t)return[3,2];return[4,E.init({dir:th(),stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:t=r.sent();r.label=2;case 2:t;return[2]}})});return tD.apply(this,arguments)}var tT={get:function t(t){return o(function(){var r,n;return p(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,tS()];case 1:e.sent();return[4,E.getItem(t)];case 2:return[2,(r=e.sent())!==null&&r!==void 0?r:null];case 3:n=e.sent();return[2,(A.error('[Storage:get] Error getting key "'.concat(t,'":'),n),null)];case 4:return[2]}})})()},set:function t(t,r){return o(function(){var n;return p(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,tS()];case 1:e.sent();return[4,E.setItem(t,r)];case 2:e.sent();return[3,4];case 3:n=e.sent();A.error('[Storage:set] Error setting key "'.concat(t,'":'),n);return[3,4];case 4:return[2]}})})()},remove:function t(t){return o(function(){var r;return p(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,tS()];case 1:n.sent();return[4,E.removeItem(t)];case 2:n.sent();return[3,4];case 3:r=n.sent();A.error('[Storage:remove] Error removing key "'.concat(t,'":'),r);return[3,4];case 4:return[2]}})})()},keys:function t(){return o(function(){var t,r;return p(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,tS()];case 1:n.sent();return[4,E.keys()];case 2:t=n.sent();return[2,Array.isArray(t)?t:(A.warn("[Storage:keys] Invalid keys response:",t),[])];case 3:r=n.sent();return[2,(A.error("[Storage:keys] Error getting keys:",r),[])];case 4:return[2]}})})()},getLogLink:function t(t){return o(function(){return p(this,function(r){try{return[2,"".concat(th()," (key: ").concat(t,")")]}catch(t){return[2,(A.error("[Storage:getLogLink] Error getting log link:",t),null)]}return[2]})})()}};export{th as getStorageDir,tS as initNodePersist,tT as storageServer};