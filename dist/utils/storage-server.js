function t(t,n){if(n==null||n>t.length)n=t.length;for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function n(t){if(Array.isArray(t))return t}function r(n){if(Array.isArray(n))return t(n)}function e(t,n,r,e,o,c,a){try{var i=t[c](a);var s=i.value}catch(t){r(t);return}if(i.done){n(s)}else{Promise.resolve(s).then(e,o)}}function o(t){return function(){var n=this,r=arguments;return new Promise(function(o,c){var a=t.apply(n,r);function i(t){e(a,o,c,i,s,"next",t)}function s(t){e(a,o,c,i,s,"throw",t)}i(undefined)})}}function c(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function a(t,n){var r=t==null?null:typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(r==null)return;var e=[];var o=true;var c=false;var a,i;try{for(r=r.call(t);!(o=(a=r.next()).done);o=true){e.push(a.value);if(n&&e.length===n)break}}catch(t){c=true;i=t}finally{try{if(!o&&r["return"]!=null)r["return"]()}finally{if(c)throw i}}return e}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,r){return n(t)||a(t,r)||_(t,r)||i()}function l(t){return r(t)||c(t)||_(t)||s()}function f(t){"@swc/helpers - typeof";return t&&typeof Symbol!=="undefined"&&t.constructor===Symbol?"symbol":typeof t}function _(n,r){if(!n)return;if(typeof n==="string")return t(n,r);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor)e=n.constructor.name;if(e==="Map"||e==="Set")return Array.from(e);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return t(n,r)}function E(t,n){var r,e,o,c,a={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),"throw":i(1),"return":i(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function i(t){return function(n){return s([t,n])}}function s(c){if(r)throw new TypeError("Generator is already executing.");while(a)try{if(r=1,e&&(o=c[0]&2?e["return"]:c[0]?e["throw"]||((o=e["return"])&&o.call(e),0):e.next)&&!(o=o.call(e,c[1])).done)return o;if(e=0,o)c=[c[0]&2,o.value];switch(c[0]){case 0:case 1:o=c;break;case 4:a.label++;return{value:c[1],done:false};case 5:a.label++;e=c[1];c=[0];continue;case 7:c=a.ops.pop();a.trys.pop();continue;default:if(!(o=a.trys,o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1];o=c;break}if(o&&a.label<o[2]){a.label=o[2];a.ops.push(c);break}if(o[2])a.ops.pop();a.trys.pop();continue}c=n.call(t,a)}catch(t){c=[6,t];e=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}import p from"node-persist";import y from"node:os";import I from"node:process";import g from"node:process";import d from"boxen";import m from"chalk";import{exec as N}from"node:child_process";import*as S from"node:util";var T=process.env.DEBUG==="true";import D from"node-fetch";import*as h from"node:path";function v(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}var e;return(e=h).resolve.apply(e,[R].concat(l(n)))}function A(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}var e;return(e=h).join.apply(e,l(n))}var C=24*60*60*1e3;var O=S.promisify(N),b=m.gray,P=m.blue;function L(t){return{raw:!0,cmd:t}}function G(t,n){return(n===null||n===void 0?void 0:n.isRemote)?"".concat(tu," ").concat(w," ").concat(t):(n===null||n===void 0?void 0:n.isCurrentProject)?"".concat(tu," ").concat(ta," src/cli.ts ").concat(t):"".concat(tu," ").concat(J," ").concat(t)}function M(t,n){return typeof t=="function"?G(t(n),n):(typeof t==="undefined"?"undefined":f(t))=="object"&&(t===null||t===void 0?void 0:t.raw)===!0?t.cmd:typeof t=="string"?G(t,n):t}var R=g.env.INIT_CWD||g.cwd(),w="@cyberskill/shared",k=".cyberskill-storage",K="node_modules",j="dist",Y="package.json",F="package-lock.json",X="tsconfig.json",U=".gitignore",x=".simple-git-hooks.json",B="pnpm-lock.yaml",W=".git/hooks/",V=".git/COMMIT_EDITMSG",H=A(R,K,w,j),J="cyberskill",$="eslint",q="eslint",z="vitest",Q="playwright",Z="vitest",tt="@commitlint/cli",tn="commitlint",tr="lint-staged",te="lint-staged",to="typescript",tc="tsc",ta="tsx",ti="git",ts="pnpm",tu="pnpm exec",tl="simple-git-hooks",tf="simple-git-hooks",t_="@eslint/config-inspector",tE="eslint-config-inspector",tp="node-modules-inspector",ty="node-modules-inspector",tI={CYBERSKILL_DIRECTORY:H,WORKING_DIRECTORY:R,TS_CONFIG:v(X),GIT_IGNORE:v(U),GIT_HOOK:v(W),GIT_COMMIT_MSG:v(V),SIMPLE_GIT_HOOKS_JSON:v(x),PACKAGE_JSON:v(Y),PACKAGE_LOCK_JSON:v(F),PNPM_LOCK_YAML:v(B),NODE_MODULES:v(K),CYBERSKILL:{LINT_STAGED_CONFIG:v("".concat(H,"/configs/lint-staged/base.js")),COMMITLINT_CONFIG:v("".concat(H,"/configs/commitlint/base.js")),UNIT_TEST_CONFIG:v("".concat(H,"/configs/vitest/react/unit.js")),UNIT_TEST_SETUP_CONFIG:v("".concat(H,"/configs/vitest/react/unit.setup.js")),E2E_TEST_CONFIG:v("".concat(H,"/configs/vitest/react/e2e.js"))}};function tg(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),e=1;e<n;e++){r[e-1]=arguments[e]}var o=u(r,2),c=o[0],a=o[1];switch(t){case"PNPM_ADD_AND_EXEC":return M(L("".concat(ts," add ").concat(c," && ").concat(tu," ").concat(a)));case"PNPM_ADD_DEV_AND_EXEC":return M(L("".concat(ts," add -D ").concat(c," && ").concat(tu," ").concat(a)));case"RAW":return M(L(c))}}var td={SIMPLE_GIT_HOOKS:tg("PNPM_ADD_DEV_AND_EXEC",tl,tf),ESLINT_INSPECT:tg("PNPM_ADD_DEV_AND_EXEC",t_,tE),NODE_MODULES_INSPECT:tg("PNPM_ADD_DEV_AND_EXEC",tp,ty),ESLINT_CHECK:tg("PNPM_ADD_DEV_AND_EXEC",$,"".concat(q," ").concat(tI.WORKING_DIRECTORY)),ESLINT_FIX:tg("PNPM_ADD_DEV_AND_EXEC",$,"".concat(q," ").concat(tI.WORKING_DIRECTORY," --fix")),TYPESCRIPT_CHECK:tg("PNPM_ADD_AND_EXEC",to,"".concat(tc," -p ").concat(tI.TS_CONFIG," --noEmit")),CONFIGURE_GIT_HOOK:tg("RAW","".concat(ti," config core.hooksPath ").concat(tI.GIT_HOOK)),BUILD:tg("RAW","".concat(ts," run build")),STAGE_BUILD_DIRECTORY:tg("RAW","".concat(ti," add ").concat(j)),PNPM_INSTALL_STANDARD:tg("RAW","".concat(ts," install")),PNPM_INSTALL_LEGACY:tg("RAW","".concat(ts," install --legacy-peer-deps")),PNPM_INSTALL_FORCE:tg("RAW","".concat(ts," install --force")),CYBERSKILL:{TEST_UNIT:tg("PNPM_ADD_AND_EXEC",z,"".concat(Z," --config ").concat(tI.CYBERSKILL.UNIT_TEST_CONFIG)),TEST_E2E:tg("PNPM_ADD_AND_EXEC","".concat(z," ").concat(Q),"".concat(Z," --config ").concat(tI.CYBERSKILL.E2E_TEST_CONFIG)),COMMIT_LINT:tg("PNPM_ADD_DEV_AND_EXEC",tt,"".concat(tn," --edit ").concat(tI.GIT_COMMIT_MSG," --config ").concat(tI.CYBERSKILL.COMMITLINT_CONFIG)),LINT_STAGED:tg("PNPM_ADD_DEV_AND_EXEC",tr,"".concat(te," --config ").concat(tI.CYBERSKILL.LINT_STAGED_CONFIG))}};function tm(){return I.env.CYBERSKILL_STORAGE_DIR||A(y.homedir(),k)}function tN(){return tS.apply(this,arguments)}function tS(){tS=o(function(){var t;return E(this,function(n){switch(n.label){case 0:t=p.defaultInstance;if(t)return[3,2];return[4,p.init({dir:tm(),stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:t=n.sent();n.label=2;case 2:t;return[2]}})});return tS.apply(this,arguments)}var tT={get:function t(t){return o(function(){var n,r;return E(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,tN()];case 1:e.sent();return[4,p.getItem(t)];case 2:return[2,(n=e.sent())!==null&&n!==void 0?n:null];case 3:r=e.sent();return[2,(console.error('❌ [Storage:get] Error getting key "'.concat(t,'":'),r),null)];case 4:return[2]}})})()},set:function t(t,n){return o(function(){var r;return E(this,function(e){switch(e.label){case 0:e.trys.push([0,3,,4]);return[4,tN()];case 1:e.sent();return[4,p.setItem(t,n)];case 2:e.sent();return[3,4];case 3:r=e.sent();console.error('❌ [Storage:set] Error setting key "'.concat(t,'":'),r);return[3,4];case 4:return[2]}})})()},remove:function t(t){return o(function(){var n;return E(this,function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,tN()];case 1:r.sent();return[4,p.removeItem(t)];case 2:r.sent();return[3,4];case 3:n=r.sent();console.error('❌ [Storage:remove] Error removing key "'.concat(t,'":'),n);return[3,4];case 4:return[2]}})})()},keys:function t(){return o(function(){var t,n;return E(this,function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,tN()];case 1:r.sent();return[4,p.keys()];case 2:t=r.sent();return[2,Array.isArray(t)?t:(console.warn("⚠️ [Storage:keys] Invalid keys response:",t),[])];case 3:n=r.sent();return[2,(console.error("❌ [Storage:keys] Error getting keys:",n),[])];case 4:return[2]}})})()},getLogLink:function t(t){return o(function(){return E(this,function(n){try{return[2,"".concat(tm()," (key: ").concat(t,")")]}catch(t){return[2,(console.error("❌ [Storage:getLogLink] Error getting log link:",t),null)]}return[2]})})()}};export{tm as getStorageDir,tN as initNodePersist,tT as storageServer};