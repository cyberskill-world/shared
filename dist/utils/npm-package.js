function e(e,r){if(r==null||r>e.length)r=e.length;for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function r(r){if(Array.isArray(r))return e(r)}function t(e,r,t,n,o,c,a){try{var s=e[c](a);var i=s.value}catch(e){t(e);return}if(s.done){r(i)}else{Promise.resolve(i).then(n,o)}}function n(e){return function(){var r=this,n=arguments;return new Promise(function(o,c){var a=e.apply(r,n);function s(e){t(a,o,c,s,i,"next",e)}function i(e){t(a,o,c,s,i,"throw",e)}s(undefined)})}}function o(e,r,t){if(r in e){Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true})}else{e[r]=t}return e}function c(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};var n=Object.keys(t);if(typeof Object.getOwnPropertySymbols==="function"){n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))}n.forEach(function(r){o(e,r,t[r])})}return e}function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(r){n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})}t.push.apply(t,n)}return t}function u(e,r){r=r!=null?r:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(r))}else{i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e){return r(e)||c(e)||p(e)||a()}function f(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function p(r,t){if(!r)return;if(typeof r==="string")return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);if(n==="Object"&&r.constructor)n=r.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(r,t)}function g(e,r){var t,n,o,c,a={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return c={next:s(0),"throw":s(1),"return":s(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(e){return function(r){return i([e,r])}}function i(c){if(t)throw new TypeError("Generator is already executing.");while(a)try{if(t=1,n&&(o=c[0]&2?n["return"]:c[0]?n["throw"]||((o=n["return"])&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;if(n=0,o)c=[c[0]&2,o.value];switch(c[0]){case 0:case 1:o=c;break;case 4:a.label++;return{value:c[1],done:false};case 5:a.label++;n=c[1];c=[0];continue;case 7:c=a.ops.pop();a.trys.pop();continue;default:if(!(o=a.trys,o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1];o=c;break}if(o&&a.label<o[2]){a.label=o[2];a.ops.push(c);break}if(o[2])a.ops.pop();a.trys.pop();continue}c=r.call(e,a)}catch(e){c=[6,e];n=0}finally{t=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}import d from"node-fetch";import h from"node:fs";import y from"node:path";import{dirname as m}from"node:path";import v from"node:process";import{fileURLToPath as b}from"node:url";var w=b(import.meta.url),S=m(w),O=v.env.INIT_CWD||v.cwd();import k from"boxen";import E from"chalk";import j from"localforage";import I from"node-persist";import P from"node:os";import x from"node:path";import R from"node:process";var N=(typeof window==="undefined"?"undefined":f(window))<"u",A=R.env.CYBERSKILL_STORAGE_DIR||x.join(P.homedir(),".cyberskill-storage");function F(){return T.apply(this,arguments)}function T(){T=n(function(){var e;return g(this,function(r){switch(r.label){case 0:e=!N&&!I.defaultInstance;if(!e)return[3,2];return[4,I.init({dir:A,stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:e=r.sent();r.label=2;case 2:e;return[2]}})});return T.apply(this,arguments)}var C={get:function e(e){return n(function(){var r,t,n;return g(this,function(o){switch(o.label){case 0:o.trys.push([0,6,,7]);if(!N)return[3,2];return[4,j.getItem(e)];case 1:t=o.sent();return[3,5];case 2:return[4,F()];case 3:o.sent();return[4,I.getItem(e)];case 4:t=(r=o.sent())!==null&&r!==void 0?r:null;o.label=5;case 5:return[2,t];case 6:n=o.sent();return[2,(console.error('❌ [Storage:get] Error getting key "'.concat(e,'":'),n),null)];case 7:return[2]}})})()},set:function e(e,r){return n(function(){var t,n;return g(this,function(o){switch(o.label){case 0:o.trys.push([0,6,,7]);if(!N)return[3,2];return[4,j.setItem(e,r)];case 1:t=o.sent();return[3,5];case 2:return[4,F()];case 3:o.sent();return[4,I.setItem(e,r)];case 4:t=o.sent();o.label=5;case 5:t;return[3,7];case 6:n=o.sent();console.error('❌ [Storage:set] Error setting key "'.concat(e,'":'),n);return[3,7];case 7:return[2]}})})()},remove:function e(e){return n(function(){var r,t;return g(this,function(n){switch(n.label){case 0:n.trys.push([0,6,,7]);if(!N)return[3,2];return[4,j.removeItem(e)];case 1:r=n.sent();return[3,5];case 2:return[4,F()];case 3:n.sent();return[4,I.removeItem(e)];case 4:r=n.sent();n.label=5;case 5:r;return[3,7];case 6:t=n.sent();console.error('❌ [Storage:remove] Error removing key "'.concat(e,'":'),t);return[3,7];case 7:return[2]}})})()},keys:function e(){return n(function(){var e,r,t;return g(this,function(n){switch(n.label){case 0:n.trys.push([0,5,,6]);if(!N)return[3,2];return[4,j.keys()];case 1:return[2,(e=n.sent())!==null&&e!==void 0?e:[]];case 2:return[4,F()];case 3:n.sent();return[4,I.keys()];case 4:r=n.sent();return[2,Array.isArray(r)?r:(console.warn("⚠️ [Storage:keys] Invalid keys response:",r),[])];case 5:t=n.sent();return[2,(console.error("❌ [Storage:keys] Error getting keys:",t),[])];case 6:return[2]}})})()},getLogLink:function e(e){return n(function(){return g(this,function(r){try{return[2,"".concat(A," (key: ").concat(e,")")]}catch(e){return[2,(console.error("❌ [Storage:getLogLink] Error getting log link:",e),null)]}return[2]})})()}};var D=function(e){return"error_list:".concat(e)};function L(e){return _.apply(this,arguments)}function _(){_=n(function(e){var r,t,n,o;return g(this,function(c){switch(c.label){case 0:if(!e.length)return[2];r=Date.now(),t=D(r);c.label=1;case 1:c.trys.push([1,4,,5]);return[4,C.set(t,{errors:e,timestamp:r})];case 2:c.sent();return[4,C.getLogLink(t)];case 3:n=c.sent();n&&V.info("Open the error list manually: ".concat(n));return[3,5];case 4:o=c.sent();V.error("Failed to save errors: ".concat(o.message));return[3,5];case 5:return[2]}})});return _.apply(this,arguments)}function U(){return J.apply(this,arguments)}function J(){J=n(function(){var e,r,t,n,o,c,a,s,i,u,f,p,d;return g(this,function(g){switch(g.label){case 0:g.trys.push([0,10,,11]);return[4,C.keys()];case 1:e=g.sent();if(!Array.isArray(e))return[2,(V.warning("Invalid response from storage.keys(): ".concat(e)),[])];r=e.filter(function(e){var r;return e===null||e===void 0?void 0:(r=e.startsWith)===null||r===void 0?void 0:r.call(e,"error_list:")}),t=[];n=true,o=false,c=undefined;g.label=2;case 2:g.trys.push([2,7,8,9]);a=r[Symbol.iterator]();g.label=3;case 3:if(!!(n=(s=a.next()).done))return[3,6];i=s.value;return[4,C.get(i)];case 4:f=g.sent();f&&(u=t).push.apply(u,l(f.errors));g.label=5;case 5:n=true;return[3,3];case 6:return[3,9];case 7:p=g.sent();o=true;c=p;return[3,9];case 8:try{if(!n&&a.return!=null){a.return()}}finally{if(o){throw c}}return[7];case 9:return[2,t];case 10:d=g.sent();return[2,(V.error("Failed to retrieve stored errors: ".concat(d.message)),[])];case 11:return[2]}})});return J.apply(this,arguments)}var M=E.green,G=E.yellow,W=E.red,B=E.gray,$=E.bold,K=E.blue,V={step:function(e,r,t){var n=new Date().toLocaleTimeString(),o=e!==null&&r!==null?"STEP [".concat(e,"/").concat(r,"]"):"STEP";console.log("".concat(M(o)," ").concat(B("[".concat(n,"]"))," ").concat($(t)))},success:function(e){console.log("".concat(M("✔ SUCCESS")," ").concat(e))},error:function(e){console.log("".concat(W("✖ ERROR")," ").concat(e))},warning:function(e){console.log("".concat(G("⚠ WARNING")," ").concat(e))},info:function(e){console.log("".concat(B("ℹ INFO")," ").concat(e))},boxedResult:function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:M;console.log(k($(t("".concat(e,"\n").concat(r))),{padding:1,margin:1,borderStyle:"round",borderColor:t===W?"red":t===G?"yellow":"green"}))},logResults:function(e,r,t,n){e.length&&(e.forEach(function(e){var n=e.file,o=e.position,c=e.rule,a=e.message;console.log("".concat(r("".concat(t," File:"))," ").concat(K("".concat(n).concat(o?":".concat(o):"")))),c&&console.log("   ".concat(r("Rule:")," ").concat(r(c))),console.log("   ".concat(r("Message:")," ").concat(r(a)))}),console.log(k($(r("".concat(t," Total ").concat(n,": ").concat(e.length))),{padding:1,margin:1,borderStyle:"round",borderColor:r===W?"red":r===G?"yellow":"green"})),console.log(B("─".repeat(40))))},displayResults:/*#__PURE__*/n(function(){var e,r,t;return g(this,function(n){switch(n.label){case 0:return[4,U()];case 1:e=n.sent(),r=e.filter(function(e){return e.type==="error"}),t=e.filter(function(e){return e.type==="warning"});!r.length&&!t.length?V.boxedResult("✔ NO ISSUES FOUND","",M):(V.logResults(t,G,"⚠","Warnings"),V.logResults(r,W,"✖","Errors"));return[2]}})})};import{exec as Y}from"node:child_process";import q from"node:process";import*as z from"node:util";var H=z.promisify(Y),Q=q.env.DEBUG==="true",X=/^\s*(\d+):(\d+)\s+(error|warning)\s+(\S+)\s+(\S+)$/,Z=/^(.+?)\((\d+),(\d+)\):\s+(error|warning)\s+TS\d+:\s+(\S.+)$/,ee=/^✖\s+(.*?)\s+\[(.*?)\]$/;function er(e){var r=[],t=[],n="";e.split("\n").forEach(function(e){if(e.startsWith("/"))n=e.trim();else{var o=X.exec(e)||[],c=Z.exec(e)||[],a=ee.exec(e)||[];o.length&&n?r.push({file:n,position:"".concat(o[1],":").concat(o[2]),type:o[3]==="error"?"error":"warning",message:o[4].trim(),rule:o[5].trim()}):c.length?r.push({file:c[1],position:"".concat(c[2],":").concat(c[3]),type:c[4]==="error"?"error":"warning",message:c[5].trim()}):a.length?r.push({file:"commitlint",type:"error",message:a[1].trim(),rule:a[2].trim()}):t.push(e.trim())}}),r.length&&L(r),t.length&&Q&&(V.warning("Unmatched lines:"),t.forEach(function(e){return console.log("  ".concat(e))}))}function et(e){try{var r=JSON.parse(e),t=[];r.forEach(function(e){var r=e.filePath,n=e.messages;n.forEach(function(e){var n=e.severity,o=e.line,c=e.column,a=e.ruleId,s=e.message;t.push({type:n===2?"error":"warning",file:r,position:"".concat(o,":").concat(c),rule:a,message:s})})}),t.length&&L(t)}catch(r){er(e)}}function en(e){return eo.apply(this,arguments)}function eo(){eo=n(function(e){var r,t,n,o,c,a,s,i,u;var l=arguments;return g(this,function(f){switch(f.label){case 0:r=l.length>1&&l[1]!==void 0?l[1]:et;t=new AbortController;q.on("SIGINT",function(){V.warning("Process interrupted. Terminating..."),t.abort(),q.exit()});f.label=1;case 1:f.trys.push([1,3,,4]);return[4,H(e,{maxBuffer:0x6400000,signal:t.signal})];case 2:n=f.sent(),o=n.stdout,c=n.stderr;[o,c].forEach(function(e){return e&&r(e)});return[3,4];case 3:a=f.sent();s=a.stdout,i=a.stderr,u=a.message;[s,i].forEach(function(e){return e&&r(e)}),!i&&!s&&V.error("Command failed: ".concat(u));return[3,4];case 4:return[2]}})});return eo.apply(this,arguments)}var ec=24*60*60*1e3;function ea(e){return e?y.join(O,"node_modules",e,"package.json"):y.join(O,"package.json")}function es(e){return ei.apply(this,arguments)}function ei(){ei=n(function(e){var r,t,n,o,c,a,s,i,u,l;var f=arguments;return g(this,function(p){switch(p.label){case 0:r=f.length>1&&f[1]!==void 0?f[1]:!1;t="npm_version:".concat(e),n="npm_metadata:".concat(e);return[4,C.get(t)];case 1:o=p.sent();return[4,C.get(n)];case 2:c=p.sent(),a=o&&Date.now()-o.timestamp<ec;if(!r&&a)return[2,(V.info("Using cached version for ".concat(e,": ").concat(o.version)),o.version)];s={};(c===null||c===void 0?void 0:c.etag)&&(s["If-None-Match"]=c.etag),(c===null||c===void 0?void 0:c.lastModified)&&(s["If-Modified-Since"]=c.lastModified);p.label=3;case 3:p.trys.push([3,8,,9]);V.info("Fetching latest version for ".concat(e,"..."));return[4,d("https://registry.npmjs.org/".concat(e,"/latest"),{headers:s})];case 4:i=p.sent();if(i.status===304&&o)return[2,(V.info("Cache is still valid for ".concat(e,": ").concat(o.version)),o.version)];if(!i.ok)throw new Error("Failed to fetch latest version: ".concat(i.statusText));return[4,i.json()];case 5:u=p.sent().version;return[4,C.set(t,{version:u,timestamp:Date.now()})];case 6:p.sent();return[4,C.set(n,{etag:i.headers.get("ETag")||void 0,lastModified:i.headers.get("Last-Modified")||void 0})];case 7:return[2,(p.sent(),V.success("Cached latest version for ".concat(e,": ").concat(u)),u)];case 8:l=p.sent();if(V.error("Error fetching latest version for ".concat(e,": ").concat(l.message)),o)return[2,(V.warning("Falling back to cached version for ".concat(e,": ").concat(o.version)),o.version)];throw l;case 9:return[2]}})});return ei.apply(this,arguments)}function eu(e){return el.apply(this,arguments)}function el(){el=n(function(e){var r,t,n,o,c;var a=arguments;return g(this,function(s){switch(s.label){case 0:r=a.length>1&&a[1]!==void 0?a[1]:!0;s.label=1;case 1:s.trys.push([1,3,,4]);t=ea(e);if(!h.existsSync(t))return[2,(V.info("".concat(e," is not installed.")),!0)];n=JSON.parse(h.readFileSync(t,"utf-8")).version;return[4,es(e,r)];case 2:o=s.sent();return[2,(V.info("Installed version of ".concat(e,": ").concat(n)),V.info("Latest version of ".concat(e,": ").concat(o)),n!==o)];case 3:c=s.sent();return[2,(V.warning("Failed to check version for ".concat(e,": ").concat(c.message)),!0)];case 4:return[2]}})});return el.apply(this,arguments)}function ef(e){return ep.apply(this,arguments)}function ep(){ep=n(function(e){var r,t,n,c;return g(this,function(a){switch(a.label){case 0:a.trys.push([0,4,,5]);return[4,es(e,!0)];case 1:r=a.sent(),t=ea();if(!h.existsSync(t)){V.error("package.json not found. Cannot update ".concat(e));return[2]}n=JSON.parse(h.readFileSync(t,"utf-8"));n.dependencies=u(s({},n.dependencies),o({},e,r)),h.writeFileSync(t,JSON.stringify(n,null,2)),V.info("Updated ".concat(e," to version ").concat(r));return[4,en("npm i -f")];case 2:a.sent();return[4,en("npm run lint:fix")];case 3:a.sent(),V.success("".concat(e," updated successfully."));return[3,5];case 4:c=a.sent();throw V.error("Failed to update ".concat(e,": ").concat(c.message)),c;case 5:return[2]}})});return ep.apply(this,arguments)}function eg(e,r){try{var t=y.join(e,"package.json");return h.existsSync(t)?JSON.parse(h.readFileSync(t,"utf-8")).name===r:!1}catch(e){return V.error("Error reading package.json: ".concat(e.message)),!1}}export{es as getLatestPackageVersion,eg as isCurrentProject,eu as isPackageOutdated,ef as updatePackage};