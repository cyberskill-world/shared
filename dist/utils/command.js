function r(r,e,n,t,o,s,a){try{var c=r[s](a);var i=c.value}catch(r){n(r);return}if(c.done){e(i)}else{Promise.resolve(i).then(t,o)}}function e(e){return function(){var n=this,t=arguments;return new Promise(function(o,s){var a=e.apply(n,t);function c(e){r(a,o,s,c,i,"next",e)}function i(e){r(a,o,s,c,i,"throw",e)}c(undefined)})}}function n(r,e){var n,t,o,s,a={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return s={next:c(0),"throw":c(1),"return":c(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(r){return function(e){return i([r,e])}}function i(s){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,t&&(o=s[0]&2?t["return"]:s[0]?t["throw"]||((o=t["return"])&&o.call(t),0):t.next)&&!(o=o.call(t,s[1])).done)return o;if(t=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:a.label++;return{value:s[1],done:false};case 5:a.label++;t=s[1];s=[0];continue;case 7:s=a.ops.pop();a.trys.pop();continue;default:if(!(o=a.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){a=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(s[0]===6&&a.label<o[1]){a.label=o[1];o=s;break}if(o&&a.label<o[2]){a.label=o[2];a.ops.push(s);break}if(o[2])a.ops.pop();a.trys.pop();continue}s=e.call(r,a)}catch(r){s=[6,r];t=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}}import t from"boxen";import o from"chalk";import{exec as s}from"node:child_process";import a from"node:process";import*as c from"node:util";import i from"node-persist";import u from"node:os";import l from"node:path";import f from"node:process";var g=f.env.CYBERSKILL_STORAGE_DIR||l.join(u.homedir(),".cyberskill-storage");function h(){return p.apply(this,arguments)}function p(){p=e(function(){var r;return n(this,function(e){switch(e.label){case 0:r=i.defaultInstance;if(r)return[3,2];return[4,i.init({dir:g,stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:r=e.sent();e.label=2;case 2:r;return[2]}})});return p.apply(this,arguments)}var d={get:function r(r){return e(function(){var e,t;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,h()];case 1:n.sent();return[4,i.getItem(r)];case 2:return[2,(e=n.sent())!==null&&e!==void 0?e:null];case 3:t=n.sent();return[2,(console.error('❌ [Storage:get] Error getting key "'.concat(r,'":'),t),null)];case 4:return[2]}})})()},set:function r(r,t){return e(function(){var e;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,h()];case 1:n.sent();return[4,i.setItem(r,t)];case 2:n.sent();return[3,4];case 3:e=n.sent();console.error('❌ [Storage:set] Error setting key "'.concat(r,'":'),e);return[3,4];case 4:return[2]}})})()},remove:function r(r){return e(function(){var e;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,h()];case 1:n.sent();return[4,i.removeItem(r)];case 2:n.sent();return[3,4];case 3:e=n.sent();console.error('❌ [Storage:remove] Error removing key "'.concat(r,'":'),e);return[3,4];case 4:return[2]}})})()},keys:function r(){return e(function(){var r,e;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,h()];case 1:n.sent();return[4,i.keys()];case 2:r=n.sent();return[2,Array.isArray(r)?r:(console.warn("⚠️ [Storage:keys] Invalid keys response:",r),[])];case 3:e=n.sent();return[2,(console.error("❌ [Storage:keys] Error getting keys:",e),[])];case 4:return[2]}})})()},getLogLink:function r(r){return e(function(){return n(this,function(e){try{return[2,"".concat(g," (key: ").concat(r,")")]}catch(r){return[2,(console.error("❌ [Storage:getLogLink] Error getting log link:",r),null)]}return[2]})})()}};var m=a.env.DEBUG==="true",v=c.promisify(s),y=o.gray,b=o.blue,w=function(){return y("[".concat(new Date().toLocaleTimeString(),"]"))};function S(r){var e=o[r];return typeof e=="function"?e:o.green}function E(r,e,n,t){var o=S(e);console.log("".concat(w()," ").concat(o("".concat(n," ").concat(r))," ").concat(t))}function k(r,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.color,s=o===void 0?"green":o,a=n.padding,c=a===void 0?1:a,i=n.margin,u=i===void 0?1:i,l=n.borderStyle,f=l===void 0?"round":l,g=n.titleColor,h=g===void 0?"bold":g;var p=S(s),d=S(h);if(typeof e=="string"){console.log(t(d(p("".concat(r,"\n").concat(e))),{padding:c,margin:u,borderStyle:f,borderColor:s}));return}Array.isArray(e)&&e.length&&(e.forEach(function(r){var e=r.file,n=r.position,t=r.rule,o=r.message;console.log("".concat(w()," ").concat(p("File:")," ").concat(b("".concat(e).concat(n?":".concat(n):"")))),t&&console.log("   ".concat(p("Rule:")," ").concat(p(t))),console.log("   ".concat(p("Message:")," ").concat(p(o)))}),console.log(t(d(p("".concat(r,": ").concat(e.length))),{padding:c,margin:u,borderStyle:f,borderColor:s})),console.log(y("─".repeat(40))))}var x={success:function(r){return E("SUCCESS","green","✔",r)},error:function(r){return E("ERROR","red","✖",r)},warning:function(r){return E("WARNING","yellow","⚠",r)},info:function(r){return E("INFO","blue","ℹ",r)},printBoxedLog:k},L=function(r){return"error_list:".concat(r)};function _(r){return A.apply(this,arguments)}function A(){A=e(function(r){var t,o,s;return n(this,function(a){switch(a.label){case 0:if(r.length===0)return[2];t=Date.now(),o=L(t);a.label=1;case 1:a.trys.push([1,3,,4]);return[4,d.set(o,{errors:r,timestamp:t})];case 2:a.sent(),setTimeout(/*#__PURE__*/e(function(){var r;return n(this,function(e){switch(e.label){case 0:return[4,d.getLogLink(o)];case 1:r=e.sent();r&&x.info("\uD83D\uDCC2 Open the error list manually: ".concat(r));return[2]}})}),10);return[3,4];case 3:s=a.sent();x.error("Failed to save errors: ".concat(s.message));return[3,4];case 4:return[2]}})});return A.apply(this,arguments)}function I(){return P.apply(this,arguments)}function P(){P=e(function(){var r,t,o;return n(this,function(s){switch(s.label){case 0:s.trys.push([0,3,,4]);return[4,d.keys()];case 1:r=s.sent(),t=Array.isArray(r)?r.filter(function(r){var e;return r===null||r===void 0?void 0:(e=r.startsWith)===null||e===void 0?void 0:e.call(r,"error_list:")}):[];return[4,Promise.all(t.map(/*#__PURE__*/function(){var r=e(function(r){var e;return n(this,function(n){switch(n.label){case 0:return[4,d.get(r)];case 1:return[2,((e=n.sent())===null||e===void 0?void 0:e.errors)||[]]}})});return function(e){return r.apply(this,arguments)}}()))];case 2:return[2,s.sent().flat()];case 3:o=s.sent();return[2,(x.error("Failed to retrieve stored errors: ".concat(o.message)),[])];case 4:return[2]}})});return P.apply(this,arguments)}function R(){return C.apply(this,arguments)}function C(){C=e(function(){var r,e,t;return n(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,d.keys()];case 1:r=n.sent(),e=Array.isArray(r)?r.filter(function(r){var e;return r===null||r===void 0?void 0:(e=r.startsWith)===null||e===void 0?void 0:e.call(r,"error_list:")}):[];return[4,Promise.all(e.map(function(r){return d.remove(r)}))];case 2:n.sent();return[3,4];case 3:t=n.sent();x.error("Failed to clear error lists: ".concat(t.message));return[3,4];case 4:return[2]}})});return C.apply(this,arguments)}function T(r){var e=[],n=[],t="",o=/^\s*(\d+):(\d+)\s+(error|warning)\s+(.+?)\s+(\S+)$/,s=/^(.+?)\((\d+),(\d+)\):\s+(error|warning)\s+TS\d+:\s+(\S.+)$/,a=/^✖\s+(.*?)\s+\[(.*?)\]$/;r.split("\n").forEach(function(r){if(r.startsWith("/"))t=r.trim();else{var c=o.exec(r)||[],i=s.exec(r)||[],u=a.exec(r)||[];c.length&&t?e.push({file:t,position:"".concat(c[1],":").concat(c[2]),type:c[3]==="error"?"error":"warning",message:c[4].trim(),rule:c[5].trim()}):i.length?e.push({file:i[1],position:"".concat(i[2],":").concat(i[3]),type:i[4]==="error"?"error":"warning",message:i[5].trim()}):u.length?e.push({file:"commitlint",type:"error",message:u[1].trim(),rule:u[2].trim()}):n.push(r.trim())}}),e.length&&_(e),n.length&&m&&(x.warning("Unmatched lines:"),n.forEach(function(r){return console.log("  ".concat(r))}))}function N(r){try{var e=JSON.parse(r),n=[];e.forEach(function(r){var e=r.filePath,t=r.messages;t.forEach(function(r){var t=r.severity,o=r.line,s=r.column,a=r.ruleId,c=r.message;n.push({type:t===2?"error":"warning",file:e,position:"".concat(o,":").concat(s),rule:a,message:c})})}),n.length&&_(n)}catch(e){T(r)}}function O(r){return F.apply(this,arguments)}function F(){F=e(function(r){var e,t,o,s,c,i,u,l,f;var g=arguments;return n(this,function(n){switch(n.label){case 0:e=g.length>1&&g[1]!==void 0?g[1]:N;t=new AbortController;a.on("SIGINT",function(){x.warning("Process interrupted. Terminating..."),t.abort(),a.exit()});n.label=1;case 1:n.trys.push([1,3,,4]);return[4,v(r,{maxBuffer:0x6400000,signal:t.signal})];case 2:o=n.sent(),s=o.stdout,c=o.stderr;[s,c].forEach(function(r){return r&&e(r)});return[3,4];case 3:i=n.sent();u=i.stdout,l=i.stderr,f=i.message;[u,l].forEach(function(r){return r&&e(r)}),!l&&!u&&x.error("Command failed: ".concat(f));return[3,4];case 4:return[2]}})});return F.apply(this,arguments)}export{R as clearAllErrorLists,x as commandLog,O as executeCommand,I as getStoredErrorLists,_ as saveErrorListToStorage};