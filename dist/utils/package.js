function t(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function e(t){if(Array.isArray(t))return t}function r(e){if(Array.isArray(e))return t(e)}function n(t,e,r,n,o,a,c){try{var i=t[a](c);var s=i.value}catch(t){r(t);return}if(i.done){e(s)}else{Promise.resolve(s).then(n,o)}}function o(t){return function(){var e=this,r=arguments;return new Promise(function(o,a){var c=t.apply(e,r);function i(t){n(c,o,a,i,s,"next",t)}function s(t){n(c,o,a,i,s,"throw",t)}i(undefined)})}}function a(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function c(t,e){var r=t==null?null:typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(r==null)return;var n=[];var o=true;var a=false;var c,i;try{for(r=r.call(t);!(o=(c=r.next()).done);o=true){n.push(c.value);if(e&&n.length===e)break}}catch(t){a=true;i=t}finally{try{if(!o&&r["return"]!=null)r["return"]()}finally{if(a)throw i}}return n}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,r){return e(t)||c(t,r)||p(t,r)||i()}function l(t){return r(t)||a(t)||p(t)||s()}function f(t){"@swc/helpers - typeof";return t&&typeof Symbol!=="undefined"&&t.constructor===Symbol?"symbol":typeof t}function p(e,r){if(!e)return;if(typeof e==="string")return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}function d(t,e){var r,n,o,a,c={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(t){return function(e){return s([t,e])}}function s(a){if(r)throw new TypeError("Generator is already executing.");while(c)try{if(r=1,n&&(o=a[0]&2?n["return"]:a[0]?n["throw"]||((o=n["return"])&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;if(n=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:c.label++;return{value:a[1],done:false};case 5:c.label++;n=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(o=c.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){c=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(a[0]===6&&c.label<o[1]){c.label=o[1];o=a;break}if(o&&c.label<o[2]){c.label=o[2];c.ops.push(a);break}if(o[2])c.ops.pop();c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t];n=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}}import g from"node-fetch";import _ from"node:process";import{exec as v}from"node:child_process";import*as E from"node:util";import h from"node:process";var y=h.env.DEBUG==="true";import m from"chalk";import I from"consola";import{GraphQLError as N}from"graphql";y||(I.level=4);function S(t){var e=m[t];return typeof e=="function"?e:m.green}var D={silent:I.silent,level:I.level,fatal:I.fatal,error:I.error,warn:I.warn,log:I.log,info:I.info,success:I.success,ready:I.ready,start:I.start,box:I.box,debug:I.debug,trace:I.trace,verbose:I.verbose,printBoxedLog:function t(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"red";if(!(e===null||e===void 0?void 0:e.length)){I.box(m.green(t));return}e.forEach(function(t){var e=t.file,n=t.position,o=t.rule,a=t.message;I.log("".concat(m.gray("File:")," ").concat(m.blue("".concat(e).concat(n?":".concat(n):"")))),o&&I.log("   ".concat(S(r)("Rule:")," ").concat(o)),I.log("   ".concat(S(r)("Message:")," ").concat(a))}),I.box(S(r)("".concat(t," : ").concat(e.length))),I.log(m.gray("â”€".repeat(40)))}};import T from"node-persist";import b from"node:os";import C from"node:process";import*as A from"node:path";function P(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}var n;return(n=A).resolve.apply(n,[U].concat(l(e)))}function O(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}var n;return(n=A).join.apply(n,l(e))}function L(){return C.env.CYBERSKILL_STORAGE_DIR||O(b.homedir(),X)}function w(){return M.apply(this,arguments)}function M(){M=o(function(){var t;return d(this,function(e){switch(e.label){case 0:t=T.defaultInstance;if(t)return[3,2];return[4,T.init({dir:L(),stringify:JSON.stringify,parse:JSON.parse,encoding:"utf8",logging:!1,forgiveParseErrors:!0})];case 1:t=e.sent();e.label=2;case 2:t;return[2]}})});return M.apply(this,arguments)}var k={get:function t(t){return o(function(){var e,r;return d(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,w()];case 1:n.sent();return[4,T.getItem(t)];case 2:return[2,(e=n.sent())!==null&&e!==void 0?e:null];case 3:r=n.sent();return[2,(D.error('[Storage:get] Error getting key "'.concat(t,'":'),r),null)];case 4:return[2]}})})()},set:function t(t,e){return o(function(){var r;return d(this,function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,w()];case 1:n.sent();return[4,T.setItem(t,e)];case 2:n.sent();return[3,4];case 3:r=n.sent();D.error('[Storage:set] Error setting key "'.concat(t,'":'),r);return[3,4];case 4:return[2]}})})()},remove:function t(t){return o(function(){var e;return d(this,function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,w()];case 1:r.sent();return[4,T.removeItem(t)];case 2:r.sent();return[3,4];case 3:e=r.sent();D.error('[Storage:remove] Error removing key "'.concat(t,'":'),e);return[3,4];case 4:return[2]}})})()},keys:function t(){return o(function(){var t,e;return d(this,function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,w()];case 1:r.sent();return[4,T.keys()];case 2:t=r.sent();return[2,Array.isArray(t)?t:(D.warn("[Storage:keys] Invalid keys response:",t),[])];case 3:e=r.sent();return[2,(D.error("[Storage:keys] Error getting keys:",e),[])];case 4:return[2]}})})()},getLogLink:function t(t){return o(function(){return d(this,function(e){try{return[2,"".concat(L()," (key: ").concat(t,")")]}catch(t){return[2,(D.error("[Storage:getLogLink] Error getting log link:",t),null)]}return[2]})})()}};var G=E.promisify(v);function R(t){return{raw:!0,cmd:t}}function j(t,e){return(e===null||e===void 0?void 0:e.isRemote)?"".concat(tE," ").concat(V," ").concat(t):(e===null||e===void 0?void 0:e.isCurrentProject)?"".concat(tE," ").concat(tg," src/cli.ts ").concat(t):"".concat(tE," ").concat(tr," ").concat(t)}function K(t,e){return typeof t=="function"?j(t(e),e):(typeof t==="undefined"?"undefined":f(t))=="object"&&(t===null||t===void 0?void 0:t.raw)===!0?t.cmd:typeof t=="string"?j(t,e):t}import*as F from"node:fs";function x(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return e.every(function(t){return F.existsSync(t)})}function Y(t,e){var r=F.readFileSync(t,"utf-8");if(e===null||e===void 0?void 0:e.asJson)try{var n=JSON.parse(r);if((typeof n==="undefined"?"undefined":f(n))=="object"&&n!==null)return n;throw new Error("Parsed JSON is not an object or array")}catch(e){throw new Error("Failed to parse JSON from file: ".concat(t))}return r}var U=_.env.INIT_CWD||_.cwd(),V="@cyberskill/shared",X=".cyberskill-storage",B="node_modules",J="dist",W="package.json",H="package-lock.json",q="tsconfig.json",Q=".gitignore",$=".simple-git-hooks.json",z="pnpm-lock.yaml",Z=".git/hooks/",tt=".git/COMMIT_EDITMSG",te=O(U,B,V,J),tr="cyberskill",tn="eslint",to="eslint",ta="vitest",tc="playwright",ti="vitest",ts="@commitlint/cli",tu="commitlint",tl="lint-staged",tf="lint-staged",tp="typescript",td="tsc",tg="tsx",t_="git",tv="pnpm",tE="pnpm exec",th="simple-git-hooks",ty="simple-git-hooks",tm="@eslint/config-inspector",tI="eslint-config-inspector",tN="node-modules-inspector",tS="node-modules-inspector",tD={CYBERSKILL_DIRECTORY:te,WORKING_DIRECTORY:U,TS_CONFIG:P(q),GIT_IGNORE:P(Q),GIT_HOOK:P(Z),GIT_COMMIT_MSG:P(tt),SIMPLE_GIT_HOOKS_JSON:P($),PACKAGE_JSON:P(W),PACKAGE_LOCK_JSON:P(H),PNPM_LOCK_YAML:P(z),NODE_MODULES:P(B),CYBERSKILL:{LINT_STAGED_CONFIG:P("".concat(te,"/configs/lint-staged/base.js")),COMMITLINT_CONFIG:P("".concat(te,"/configs/commitlint/base.js")),UNIT_TEST_CONFIG:P("".concat(te,"/configs/vitest/react/unit.js")),UNIT_TEST_SETUP_CONFIG:P("".concat(te,"/configs/vitest/react/unit.setup.js")),E2E_TEST_CONFIG:P("".concat(te,"/configs/vitest/react/e2e.js"))}};function tT(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++){r[n-1]=arguments[n]}var o=u(r,2),a=o[0],c=o[1],i=t==="RAW"?!0:x.apply(void 0,l(a.split(" ").map(function(t){return O(tD.NODE_MODULES,t)})));switch(t){case"PNPM_ADD_AND_EXEC":return K(R("".concat(i?"":"".concat(tv," add ").concat(a," && ")).concat(tE," ").concat(c)));case"PNPM_ADD_DEV_AND_EXEC":return K(R("".concat(i?"":"".concat(tv," add -D ").concat(a," && ")).concat(tE," ").concat(c)));case"RAW":return K(R(a))}}var tb={SIMPLE_GIT_HOOKS:tT("PNPM_ADD_DEV_AND_EXEC",th,ty),ESLINT_INSPECT:tT("PNPM_ADD_DEV_AND_EXEC",tm,tI),NODE_MODULES_INSPECT:tT("PNPM_ADD_DEV_AND_EXEC",tN,tS),ESLINT_CHECK:tT("PNPM_ADD_DEV_AND_EXEC",tn,"".concat(to," ").concat(tD.WORKING_DIRECTORY)),ESLINT_FIX:tT("PNPM_ADD_DEV_AND_EXEC",tn,"".concat(to," ").concat(tD.WORKING_DIRECTORY," --fix")),TYPESCRIPT_CHECK:tT("PNPM_ADD_AND_EXEC",tp,"".concat(td," -p ").concat(tD.TS_CONFIG," --noEmit")),CONFIGURE_GIT_HOOK:tT("RAW","".concat(t_," config core.hooksPath ").concat(tD.GIT_HOOK)),BUILD:tT("RAW","".concat(tv," run build")),STAGE_BUILD_DIRECTORY:tT("RAW","".concat(t_," add ").concat(J)),PNPM_INSTALL_STANDARD:tT("RAW","".concat(tv," install")),PNPM_INSTALL_LEGACY:tT("RAW","".concat(tv," install --legacy-peer-deps")),PNPM_INSTALL_FORCE:tT("RAW","".concat(tv," install --force")),CYBERSKILL:{TEST_UNIT:tT("PNPM_ADD_AND_EXEC",ta,"".concat(ti," --config ").concat(tD.CYBERSKILL.UNIT_TEST_CONFIG)),TEST_E2E:tT("PNPM_ADD_AND_EXEC","".concat(ta," ").concat(tc),"".concat(ti," --config ").concat(tD.CYBERSKILL.E2E_TEST_CONFIG)),COMMIT_LINT:tT("PNPM_ADD_DEV_AND_EXEC",ts,"".concat(tu," --edit ").concat(tD.GIT_COMMIT_MSG," --config ").concat(tD.CYBERSKILL.COMMITLINT_CONFIG)),LINT_STAGED:tT("PNPM_ADD_DEV_AND_EXEC",tl,"".concat(tf," --config ").concat(tD.CYBERSKILL.LINT_STAGED_CONFIG))}};var tC=24*60*60*1e3;function tA(t){var e=O(U,W);if(x(e))try{var r=Y(e,{asJson:!0});if(r.name===t)return{path:e,file:r,isCurrentProject:!0}}catch(t){D.warn("Failed to read local package.json: ".concat(t.message))}var n=O(U,B,t,W);if(x(n))try{var o=Y(n,{asJson:!0});if(o.name===t)return{path:n,file:o,isCurrentProject:!1}}catch(e){D.warn("Failed to read node_modules package.json for ".concat(t,": ").concat(e.message))}return!1}function tP(t){return tO.apply(this,arguments)}function tO(){tO=o(function(t){var e,r,n,o,a,c,i,s,u,l;var f=arguments;return d(this,function(p){switch(p.label){case 0:e=f.length>1&&f[1]!==void 0?f[1]:!1;r="npm_version:".concat(t),n="npm_metadata:".concat(t);return[4,k.get(r)];case 1:o=p.sent();return[4,k.get(n)];case 2:a=p.sent(),c=o&&Date.now()-o.timestamp<tC;if(!e&&c)return[2,o.version];i={};(a===null||a===void 0?void 0:a.etag)&&(i["If-None-Match"]=a.etag),(a===null||a===void 0?void 0:a.lastModified)&&(i["If-Modified-Since"]=a.lastModified);p.label=3;case 3:p.trys.push([3,8,,9]);return[4,g("https://registry.npmjs.org/".concat(t,"/latest"),{headers:i})];case 4:s=p.sent();if(s.status===304&&o)return[2,o.version];if(!s.ok)throw new Error("Failed to fetch latest version: ".concat(s.statusText));return[4,s.json()];case 5:u=p.sent().version;return[4,k.set(r,{version:u,timestamp:Date.now()})];case 6:p.sent();return[4,k.set(n,{etag:s.headers.get("ETag")||void 0,lastModified:s.headers.get("Last-Modified")||void 0})];case 7:return[2,(p.sent(),u)];case 8:l=p.sent();if(D.error("Error fetching latest version for ".concat(t,": ").concat(l.message)),o)return[2,(D.warn("Falling back to cached version for ".concat(t,": ").concat(o.version)),o.version)];throw l;case 9:return[2]}})});return tO.apply(this,arguments)}function tL(t){return tw.apply(this,arguments)}function tw(){tw=o(function(t){var e,r,n,o,a;return d(this,function(c){switch(c.label){case 0:e={isInstalled:!1,isCurrentProject:!1,installedPath:"",installedVersion:"",latestVersion:"",file:{}};c.label=1;case 1:c.trys.push([1,6,,7]);r=tA(t);n=r;if(!n)return[3,5];e.file=r.file,e.isInstalled=!0,e.installedPath=r.path,e.installedVersion=r.file.version,e.isCurrentProject=r.isCurrentProject;if(!r.isCurrentProject)return[3,2];o=r.file.version;return[3,4];case 2:return[4,tP(t,!0)];case 3:o=c.sent();c.label=4;case 4:n=e.latestVersion=o;c.label=5;case 5:return[2,(n,e)];case 6:a=c.sent();return[2,(D.error('Error checking package "'.concat(t,'": ').concat(a.message)),e)];case 7:return[2]}})});return tw.apply(this,arguments)}export{tL as checkPackage,tP as getLatestPackageVersion,tA as getPackageJson};