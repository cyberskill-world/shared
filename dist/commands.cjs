#!/usr/bin/env node
"use strict";function n(n,t,e,r,i,c,s){try{var o=n[c](s);var u=o.value}catch(n){e(n);return}if(o.done){t(u)}else{Promise.resolve(u).then(r,i)}}function t(t){return function(){var e=this,r=arguments;return new Promise(function(i,c){var s=t.apply(e,r);function o(t){n(s,i,c,o,u,"next",t)}function u(t){n(s,i,c,o,u,"throw",t)}o(undefined)})}}function e(n,t,e){if(t in n){Object.defineProperty(n,t,{value:e,enumerable:true,configurable:true,writable:true})}else{n[t]=e}return n}function r(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};var i=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){i=i.concat(Object.getOwnPropertySymbols(r).filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable}))}i.forEach(function(t){e(n,t,r[t])})}return n}function i(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);if(t){r=r.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})}e.push.apply(e,r)}return e}function c(n,t){t=t!=null?t:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(n,Object.getOwnPropertyDescriptors(t))}else{i(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}function s(n){"@swc/helpers - typeof";return n&&typeof Symbol!=="undefined"&&n.constructor===Symbol?"symbol":typeof n}function o(n,t){var e,r,i,c,s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]};return c={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function o(n){return function(t){return u([n,t])}}function u(c){if(e)throw new TypeError("Generator is already executing.");while(s)try{if(e=1,r&&(i=c[0]&2?r["return"]:c[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;if(r=0,i)c=[c[0]&2,i.value];switch(c[0]){case 0:case 1:i=c;break;case 4:s.label++;return{value:c[1],done:false};case 5:s.label++;r=c[1];c=[0];continue;case 7:c=s.ops.pop();s.trys.pop();continue;default:if(!(i=s.trys,i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1];i=c;break}if(i&&s.label<i[2]){s.label=i[2];s.ops.push(c);break}if(i[2])s.ops.pop();s.trys.pop();continue}c=t.call(n,s)}catch(n){c=[6,n];r=0}finally{e=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}var u=Object.create;var a=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var d=function(n,t,e,r){var i=true,c=false,o=undefined;if(t&&(typeof t==="undefined"?"undefined":s(t))=="object"||typeof t=="function")try{var u=function(){var i=d.value;!h.call(n,i)&&i!==e&&a(n,i,{get:function(){return t[i]},enumerable:!(r=l(t,i))||r.enumerable})};for(var p=f(t)[Symbol.iterator](),d;!(i=(d=p.next()).done);i=true)u()}catch(n){c=true;o=n}finally{try{if(!i&&p.return!=null){p.return()}}finally{if(c){throw o}}}return n};var g=function(n,t,e){return e=n!=null?u(p(n)):{},d(t||!n||!n.__esModule?a(e,"default",{value:n,enumerable:!0}):e,n)};var y=function(){return(typeof document==="undefined"?"undefined":s(document))>"u"?new URL("file:".concat(__filename)).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href},m=y();var _=g(require("boxen"),1),b=g(require("chalk"),1),v=g(require("node-fetch"),1),w=require("child_process"),I=g(require("fs"),1),S=g(require("path"),1),O=g(require("process"),1),P=g(require("util"),1),T=g(require("ora"),1),E=require("yargs/helpers"),N=g(require("yargs/yargs"),1);var j=require("path"),x=require("url"),C=(0,x.fileURLToPath)(m),k=(0,j.dirname)(C);var R=b.default,D=R.blue,A=R.red,U=R.yellow,W=R.green,G=R.gray,H=R.white,M=R.bold,F=P.promisify(w.exec),K={FILE_EXTENSIONS:"**/*.{ts,tsx,js,jsx,json,css,scss,less}",INIT_CWD:O.default.env.INIT_CWD||O.default.cwd(),TSCONFIG_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/tsconfig.json"),HUSKY_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.husky"),GIT_HOOK_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.git/hooks"),GIT_COMMIT_MSG:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.git/COMMIT_EDITMSG"),SIMPLE_GIT_HOOKS_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.simple-git-hooks.json"),PACKAGE_NAME:"@cyberskill/shared"},q=[];function L(n){return(0,T.default)({text:n,color:"cyan",spinner:"dots"})}function J(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";var e=new Date().toLocaleString();console.log("".concat(t," [").concat(e,"] ").concat(H(n)))}function Y(n,t){return $.apply(this,arguments)}function $(){$=t(function(n,t){var e,r,i,c,s,u,a,l,f;var p=arguments;return o(this,function(o){switch(o.label){case 0:e=p.length>2&&p[2]!==void 0?p[2]:z;J(t);r=new AbortController;O.default.on("SIGINT",function(){console.log("Terminating process..."),r.abort(),O.default.exit()});o.label=1;case 1:o.trys.push([1,3,,4]);return[4,F(n,{maxBuffer:0x6400000,signal:r.signal})];case 2:i=o.sent(),c=i.stdout,s=i.stderr;[c,s].forEach(function(n){return n&&e(n)});return[3,4];case 3:u=o.sent();a=u.stdout,l=u.stderr,f=u.message;[a,l].forEach(function(n){return n&&e(n)}),!l&&!a&&console.error("Command failed: ".concat(f));return[3,4];case 4:return[2]}})});return $.apply(this,arguments)}function B(n,t){return X.apply(this,arguments)}function X(){X=t(function(n,t){var e,r;return o(this,function(i){switch(i.label){case 0:e=L(n).start();i.label=1;case 1:i.trys.push([1,3,,4]);return[4,t()];case 2:i.sent(),q.length?O.default.exit(1):e.succeed("".concat(n," completed successfully!"));return[3,4];case 3:r=i.sent();throw e.fail("".concat(n," failed.")),r;case 4:return[2]}})});return X.apply(this,arguments)}function z(n){try{JSON.parse(n).forEach(function(n){var t=n.filePath,e=n.messages;e.forEach(function(n){var e=n.severity,r=n.line,i=n.column,c=n.ruleId,s=n.message;q.push({type:e===2?"error":"warning",file:t,position:"".concat(r,":").concat(i),rule:c,message:s})})})}catch(t){Q(n)}}function Q(n){var t=/^\s*(\d+):(\d+)\s+(error|warning)\s+(\S+)\s+(\S+)$/,e=/^(.+?)\((\d+),(\d+)\):\s+(error|warning)\s+TS\d+:\s+(\S.+)$/,r=/^✖\s+(.*?)\s+\[(.*?)\]$/,i=[],c="";n.split("\n").forEach(function(n){if(n.startsWith("/"))c=n.trim();else{var s=t.exec(n);if(s&&c)q.push({file:c,position:"".concat(s[1],":").concat(s[2]),type:s[3]==="error"?"error":"warning",message:s[4].trim(),rule:s[5].trim()});else{var o=e.exec(n);if(o)q.push({file:o[1],position:"".concat(o[2],":").concat(o[3]),type:o[4],message:o[5].trim()});else{var u=r.exec(n);u?q.push({file:"commitlint",type:"error",message:u[1].trim(),rule:u[2].trim()}):i.push(n.trim())}}}}),i.length>0&&(console.log(G("Unmatched lines:")),i.forEach(function(n){return console.info(n)}))}function V(n,t){var e=new Map([[A,"red"],[U,"yellow"],[W,"green"]]).get(t)||"green";return(0,_.default)(M(t(n)),{padding:1,margin:1,borderStyle:"arrow",borderColor:e})}function Z(n,t,e,r){n.length&&(n.forEach(function(n){var r=n.file,i=n.position,c=n.rule,s=n.message;console.log("".concat(t("".concat(e," File:"))," ").concat(D("".concat(r).concat(i?":".concat(i):"")))),c&&console.log("   ".concat(t("Rule:")," ").concat(t(c))),console.log("   ".concat(t("Message:")," ").concat(t(s)))}),console.log(V(M(t("".concat(e," Total ").concat(r,": ").concat(n.length))),t)),console.log(G("─".repeat(40))))}function nn(){var n=q.filter(function(n){return n.type==="error"}),t=q.filter(function(n){return n.type==="warning"});!n.length&&!t.length?console.log(V(M(W("✔ NO ISSUE FOUND!")),W)):(Z(t,U,"⚠","Warnings"),Z(n,A,"✖","Errors"))}function nt(){return ne.apply(this,arguments)}function ne(){ne=t(function(){var n;return o(this,function(t){switch(t.label){case 0:if(!I.existsSync(K.TSCONFIG_PATH))return[3,2];return[4,Y("npx tsc -p ".concat(K.TSCONFIG_PATH," --noEmit"),"TypeScript checking...")];case 1:n=t.sent();return[3,3];case 2:n=J("tsconfig.json file not found.","⚠️");t.label=3;case 3:n;return[2]}})});return ne.apply(this,arguments)}function nr(){return ni.apply(this,arguments)}function ni(){ni=t(function(){var n,t;var e=arguments;return o(this,function(r){switch(r.label){case 0:n=e.length>0&&e[0]!==void 0?e[0]:!1;t="npx eslint ".concat(K.INIT_CWD).concat(n?" --fix":" --format json");return[4,Y(t,"Eslint ".concat(n?"fixing":"checking","..."))];case 1:r.sent();return[2]}})});return ni.apply(this,arguments)}function nc(){return ns.apply(this,arguments)}function ns(){ns=t(function(){return o(this,function(n){switch(n.label){case 0:return[4,Y('npx lint-staged -- "*": "eslint --fix"',"Lint-staged processing...")];case 1:n.sent();return[2]}})});return ns.apply(this,arguments)}function no(){return nu.apply(this,arguments)}function nu(){nu=t(function(){return o(this,function(n){switch(n.label){case 0:J("Starting lint check for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Running lint checks...",/*#__PURE__*/t(function(){return o(this,function(n){switch(n.label){case 0:q.length=0;return[4,Promise.all([nt(),nr()])];case 1:n.sent(),nn();return[2]}})}))];case 1:n.sent();return[2]}})});return nu.apply(this,arguments)}function na(){return nl.apply(this,arguments)}function nl(){nl=t(function(){return o(this,function(n){switch(n.label){case 0:J("Starting lint and format fix for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Fixing issues...",/*#__PURE__*/t(function(){return o(this,function(n){switch(n.label){case 0:return[4,nr(!0)];case 1:n.sent();return[2]}})}))];case 1:n.sent();return[2]}})});return nl.apply(this,arguments)}function nf(){return np.apply(this,arguments)}function np(){np=t(function(){return o(this,function(n){switch(n.label){case 0:return[4,Y("npx @eslint/config-inspector","Lint inspect processing...")];case 1:n.sent();return[2]}})});return np.apply(this,arguments)}function nh(){return nd.apply(this,arguments)}function nd(){nd=t(function(){return o(this,function(n){switch(n.label){case 0:J("Starting lint-staged process for ".concat(O.default.env.INIT_CWD),"\uD83D\uDE80");return[4,B("Running lint-staged...",/*#__PURE__*/t(function(){return o(this,function(n){switch(n.label){case 0:q.length=0;return[4,Promise.all([nt(),nc()])];case 1:n.sent(),nn();return[2]}})}))];case 1:n.sent();return[2]}})});return nd.apply(this,arguments)}function ng(){return ny.apply(this,arguments)}function ny(){ny=t(function(){return o(this,function(n){switch(n.label){case 0:J("Starting commitlint process for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Running commitlint...",/*#__PURE__*/t(function(){var n,t;return o(this,function(e){switch(e.label){case 0:q.length=0;n=S.resolve(k,"./configs/commitlint/commitlint.base.js"),t="npx --no -- commitlint --edit ".concat(K.GIT_COMMIT_MSG," --config ").concat(n);return[4,Y(t,"Commitlint processing...")];case 1:e.sent(),nn();return[2]}})}))];case 1:n.sent();return[2]}})});return ny.apply(this,arguments)}function nm(){return n_.apply(this,arguments)}function n_(){n_=t(function(){var n;return o(this,function(t){switch(t.label){case 0:n=I.existsSync(K.HUSKY_PATH);if(!n)return[3,2];return[4,Y("npx rimraf ".concat(K.HUSKY_PATH," ").concat(K.GIT_HOOK_PATH," && git config core.hooksPath ").concat(K.GIT_HOOK_PATH),"Removing husky hooks...")];case 1:n=t.sent();t.label=2;case 2:n,I.writeFileSync(K.SIMPLE_GIT_HOOKS_PATH,JSON.stringify({"pre-commit":"npx --yes cyberskill lint-staged","commit-msg":"npx --yes cyberskill commitlint"},null,4));return[4,Y("npx simple-git-hooks","Setting up git hooks...")];case 3:t.sent(),I.unlinkSync(K.SIMPLE_GIT_HOOKS_PATH);return[2]}})});return n_.apply(this,arguments)}function nb(){return nv.apply(this,arguments)}function nv(){nv=t(function(){return o(this,function(n){switch(n.label){case 0:J("Starting setup process for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Setting up...",/*#__PURE__*/t(function(){var n,i,s,u,a,l,f,p,h;return o(this,function(d){switch(d.label){case 0:i="".concat(K.INIT_CWD,"/package.json"),s=/*#__PURE__*/function(){var n=t(function(){return o(this,function(n){switch(n.label){case 0:return[4,(0,v.default)("https://registry.npmjs.org/".concat(K.PACKAGE_NAME,"/latest"))];case 1:return[4,n.sent().json()];case 2:return[2,n.sent().version]}})});return function t(){return n.apply(this,arguments)}}(),u=/*#__PURE__*/function(){var n=t(function(){var n,t,e,r;return o(this,function(i){switch(i.label){case 0:return[4,s()];case 1:n=i.sent();try{t="".concat(K.INIT_CWD,"/node_modules/").concat(K.PACKAGE_NAME,"/package.json"),e=JSON.parse(I.readFileSync(t,"utf-8")),r=e.version;return[2,r!==n]}catch(n){return[2,!0]}return[2]}})});return function t(){return n.apply(this,arguments)}}(),a=/*#__PURE__*/function(){var n=t(function(){var n,t;return o(this,function(o){switch(o.label){case 0:return[4,s()];case 1:n=o.sent(),t=JSON.parse(I.readFileSync(i,"utf-8"));t.dependencies=c(r({},t.dependencies),e({},K.PACKAGE_NAME,n)),I.writeFileSync(i,JSON.stringify(t,null,2));return[4,Y("npm i -f","Installing all dependencies with updated cyberskill...")];case 2:o.sent();return[4,Y("npm run lint:fix","Fixing lint issues...")];case 3:o.sent();return[2]}})});return function t(){return n.apply(this,arguments)}}(),l=JSON.parse(I.readFileSync(i,"utf-8"));if(!(l.name===K.PACKAGE_NAME))return[3,1];f=J("Cyberskill is the current project. No setup needed.","✅");return[3,7];case 1:h=!((n=l.dependencies)===null||n===void 0?void 0:n.cyberskill);if(h)return[3,3];return[4,u()];case 2:h=d.sent();d.label=3;case 3:if(!h)return[3,5];J("Cyberskill is missing or outdated. Updating...");return[4,a()];case 4:p=d.sent();return[3,6];case 5:p=J("Cyberskill is up to date","✅");d.label=6;case 6:f=p;d.label=7;case 7:f,nm();return[2]}})}))];case 1:n.sent();return[2]}})});return nv.apply(this,arguments)}function nw(){return nI.apply(this,arguments)}function nI(){nI=t(function(){return o(this,function(n){switch(n.label){case 0:J("Starting reset process for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Resetting...",/*#__PURE__*/t(function(){return o(this,function(n){switch(n.label){case 0:return[4,Y("npx rimraf ".concat(K.INIT_CWD,"/node_modules ").concat(K.INIT_CWD,"/package-lock.json"),"Cleaning node_modules and package-lock.json...")];case 1:n.sent();return[4,Y("npm i -f","Installing all dependencies...")];case 2:n.sent(),nm();return[2]}})}))];case 1:n.sent();return[2]}})});return nI.apply(this,arguments)}function nS(){return nO.apply(this,arguments)}function nO(){nO=t(function(){var n;return o(this,function(e){switch(e.label){case 0:n=S.resolve(k,"./configs/vitest/react/unit.js");J("Starting unit tests for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Running unit tests...",/*#__PURE__*/t(function(){return o(this,function(t){switch(t.label){case 0:return[4,Y("npx vitest --config ".concat(n),"Running unit tests...")];case 1:t.sent();return[2]}})}))];case 1:e.sent();return[2]}})});return nO.apply(this,arguments)}function nP(){return nT.apply(this,arguments)}function nT(){nT=t(function(){var n;return o(this,function(e){switch(e.label){case 0:n=S.resolve(k,"./configs/vitest/react/e2e.js");J("Starting e2e tests for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,B("Running end-to-end tests...",/*#__PURE__*/t(function(){return o(this,function(t){switch(t.label){case 0:return[4,Y("npx vitest --config ".concat(n),"Running e2e tests...")];case 1:t.sent();return[2]}})}))];case 1:e.sent();return[2]}})});return nT.apply(this,arguments)}(0,N.default)((0,E.hideBin)(O.default.argv)).command("lint","Run linting checks",no).command("lint:fix","Fix linting and formatting issues",na).command("lint:inspect","Inspect linting rules",nf).command("lint-staged","Run lint-staged with given configuration",nh).command("commitlint","Run commitlint with given configuration",ng).command("setup","Run setup with given configuration",nb).command("reset","Reset dependencies and install",nw).command("test:unit","Run unit tests",nS).command("test:e2e","Run e2e tests",nP).help().parse();