#!/usr/bin/env node
"use strict";function n(n,e,t,r,i,c,s){try{var o=n[c](s);var u=o.value}catch(n){t(n);return}if(o.done){e(u)}else{Promise.resolve(u).then(r,i)}}function e(e){return function(){var t=this,r=arguments;return new Promise(function(i,c){var s=e.apply(t,r);function o(e){n(s,i,c,o,u,"next",e)}function u(e){n(s,i,c,o,u,"throw",e)}o(undefined)})}}function t(n,e,t){if(e in n){Object.defineProperty(n,e,{value:t,enumerable:true,configurable:true,writable:true})}else{n[e]=t}return n}function r(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};var i=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){i=i.concat(Object.getOwnPropertySymbols(r).filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable}))}i.forEach(function(e){t(n,e,r[e])})}return n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);if(e){r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})}t.push.apply(t,r)}return t}function c(n,e){e=e!=null?e:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(n,Object.getOwnPropertyDescriptors(e))}else{i(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function s(n){"@swc/helpers - typeof";return n&&typeof Symbol!=="undefined"&&n.constructor===Symbol?"symbol":typeof n}function o(n,e){var t,r,i,c,s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]};return c={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function o(n){return function(e){return u([n,e])}}function u(c){if(t)throw new TypeError("Generator is already executing.");while(s)try{if(t=1,r&&(i=c[0]&2?r["return"]:c[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;if(r=0,i)c=[c[0]&2,i.value];switch(c[0]){case 0:case 1:i=c;break;case 4:s.label++;return{value:c[1],done:false};case 5:s.label++;r=c[1];c=[0];continue;case 7:c=s.ops.pop();s.trys.pop();continue;default:if(!(i=s.trys,i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1];i=c;break}if(i&&s.label<i[2]){s.label=i[2];s.ops.push(c);break}if(i[2])s.ops.pop();s.trys.pop();continue}c=e.call(n,s)}catch(n){c=[6,n];r=0}finally{t=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:true}}}var u=Object.create;var a=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var d=function(n,e,t,r){var i=true,c=false,o=undefined;if(e&&(typeof e==="undefined"?"undefined":s(e))=="object"||typeof e=="function")try{var u=function(){var i=d.value;!h.call(n,i)&&i!==t&&a(n,i,{get:function(){return e[i]},enumerable:!(r=l(e,i))||r.enumerable})};for(var p=f(e)[Symbol.iterator](),d;!(i=(d=p.next()).done);i=true)u()}catch(n){c=true;o=n}finally{try{if(!i&&p.return!=null){p.return()}}finally{if(c){throw o}}}return n};var g=function(n,e,t){return t=n!=null?u(p(n)):{},d(e||!n||!n.__esModule?a(t,"default",{value:n,enumerable:!0}):t,n)};var y=function(){return(typeof document==="undefined"?"undefined":s(document))>"u"?new URL("file:".concat(__filename)).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href},m=y();var b=g(require("boxen"),1),_=g(require("chalk"),1),v=g(require("node-fetch"),1),w=require("child_process"),I=g(require("fs"),1),S=g(require("path"),1),O=g(require("process"),1),T=g(require("util"),1),P=g(require("ora"),1),N=require("yargs/helpers"),x=g(require("yargs/yargs"),1);var E=require("path"),j=require("url"),C=(0,j.fileURLToPath)(m),k=(0,E.dirname)(C);var R=_.default,D=R.blue,A=R.red,W=R.yellow,U=R.green,G=R.gray,H=R.white,M=R.bold,F=T.promisify(w.exec),K={FILE_EXTENSIONS:"**/*.{ts,tsx,js,jsx,json,css,scss,less}",INIT_CWD:O.default.env.INIT_CWD||O.default.cwd(),TSCONFIG_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/tsconfig.json"),HUSKY_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.husky"),GIT_HOOK_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.git/hooks"),GIT_COMMIT_MSG:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.git/COMMIT_EDITMSG"),SIMPLE_GIT_HOOKS_PATH:"".concat(O.default.env.INIT_CWD||O.default.cwd(),"/.simple-git-hooks.json"),PACKAGE_NAME:"@cyberskill/shared"},q=[];function L(n){return(0,P.default)({text:n,color:"cyan",spinner:"dots"})}function J(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";var t=new Date().toLocaleString();console.log("".concat(e," [").concat(t,"] ").concat(H(n)))}function B(n,e){return Y.apply(this,arguments)}function Y(){Y=e(function(n,e){var t,r,i,c,s,u,a,l,f;var p=arguments;return o(this,function(o){switch(o.label){case 0:t=p.length>2&&p[2]!==void 0?p[2]:z;J(e);r=new AbortController;O.default.on("SIGINT",function(){console.log("Terminating process..."),r.abort(),O.default.exit()});o.label=1;case 1:o.trys.push([1,3,,4]);return[4,F(n,{maxBuffer:0x6400000,signal:r.signal})];case 2:i=o.sent(),c=i.stdout,s=i.stderr;[c,s].forEach(function(n){return n&&t(n)});return[3,4];case 3:u=o.sent();a=u.stdout,l=u.stderr,f=u.message;[a,l].forEach(function(n){return n&&t(n)}),!l&&!a&&console.error("Command failed: ".concat(f));return[3,4];case 4:return[2]}})});return Y.apply(this,arguments)}function $(n,e){return X.apply(this,arguments)}function X(){X=e(function(n,e){var t,r;return o(this,function(i){switch(i.label){case 0:t=L(n).start();i.label=1;case 1:i.trys.push([1,3,,4]);return[4,e()];case 2:i.sent(),q.length?O.default.exit(1):t.succeed("".concat(n," completed successfully!"));return[3,4];case 3:r=i.sent();throw t.fail("".concat(n," failed.")),r;case 4:return[2]}})});return X.apply(this,arguments)}function z(n){try{JSON.parse(n).forEach(function(n){var e=n.filePath,t=n.messages;t.forEach(function(n){var t=n.severity,r=n.line,i=n.column,c=n.ruleId,s=n.message;q.push({type:t===2?"error":"warning",file:e,position:"".concat(r,":").concat(i),rule:c,message:s})})})}catch(e){Q(n)}}function Q(n){var e=/^\s*(\d+):(\d+)\s+(error|warning)\s+(\S+)\s+(\S+)$/,t=/^(.+?)\((\d+),(\d+)\):\s+(error|warning)\s+TS\d+:\s+(\S.+)$/,r=/^✖\s+(.*?)\s+\[(.*?)\]$/,i=[],c="";n.split("\n").forEach(function(n){if(n.startsWith("/"))c=n.trim();else{var s=e.exec(n);if(s&&c)q.push({file:c,position:"".concat(s[1],":").concat(s[2]),type:s[3]==="error"?"error":"warning",message:s[4].trim(),rule:s[5].trim()});else{var o=t.exec(n);if(o)q.push({file:o[1],position:"".concat(o[2],":").concat(o[3]),type:o[4],message:o[5].trim()});else{var u=r.exec(n);u?q.push({file:"commitlint",type:"error",message:u[1].trim(),rule:u[2].trim()}):i.push(n.trim())}}}}),i.length>0&&(console.log(G("Unmatched lines:")),i.forEach(function(n){return console.info(n)}))}function V(n,e){var t=new Map([[A,"red"],[W,"yellow"],[U,"green"]]).get(e)||"green";return(0,b.default)(M(e(n)),{padding:1,margin:1,borderStyle:"arrow",borderColor:t})}function Z(n,e,t,r){n.length&&(n.forEach(function(n){var r=n.file,i=n.position,c=n.rule,s=n.message;console.log("".concat(e("".concat(t," File:"))," ").concat(D("".concat(r).concat(i?":".concat(i):"")))),c&&console.log("   ".concat(e("Rule:")," ").concat(e(c))),console.log("   ".concat(e("Message:")," ").concat(e(s)))}),console.log(V(M(e("".concat(t," Total ").concat(r,": ").concat(n.length))),e)),console.log(G("─".repeat(40))))}function nn(){var n=q.filter(function(n){return n.type==="error"}),e=q.filter(function(n){return n.type==="warning"});!n.length&&!e.length?console.log(V(M(U("✔ NO ISSUE FOUND!")),U)):(Z(e,W,"⚠","Warnings"),Z(n,A,"✖","Errors"))}function ne(){return nt.apply(this,arguments)}function nt(){nt=e(function(){var n;return o(this,function(e){switch(e.label){case 0:if(!I.existsSync(K.TSCONFIG_PATH))return[3,2];return[4,B("npx tsc -p ".concat(K.TSCONFIG_PATH," --noEmit"),"TypeScript checking...")];case 1:n=e.sent();return[3,3];case 2:n=J("tsconfig.json file not found.","⚠️");e.label=3;case 3:n;return[2]}})});return nt.apply(this,arguments)}function nr(){return ni.apply(this,arguments)}function ni(){ni=e(function(){var n,e;var t=arguments;return o(this,function(r){switch(r.label){case 0:n=t.length>0&&t[0]!==void 0?t[0]:!1;e="npx eslint ".concat(K.INIT_CWD).concat(n?" --fix":" --format json");return[4,B(e,"Eslint ".concat(n?"fixing":"checking","..."))];case 1:r.sent();return[2]}})});return ni.apply(this,arguments)}function nc(){return ns.apply(this,arguments)}function ns(){ns=e(function(){return o(this,function(n){switch(n.label){case 0:return[4,B('npx lint-staged -- "*": "eslint --fix"',"Lint-staged processing...")];case 1:n.sent();return[2]}})});return ns.apply(this,arguments)}function no(){return nu.apply(this,arguments)}function nu(){nu=e(function(){return o(this,function(n){switch(n.label){case 0:J("Starting lint check for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Running lint checks...",/*#__PURE__*/e(function(){return o(this,function(n){switch(n.label){case 0:q.length=0;return[4,Promise.all([ne(),nr()])];case 1:n.sent(),nn();return[2]}})}))];case 1:n.sent();return[2]}})});return nu.apply(this,arguments)}function na(){return nl.apply(this,arguments)}function nl(){nl=e(function(){return o(this,function(n){switch(n.label){case 0:J("Starting lint and format fix for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Fixing issues...",/*#__PURE__*/e(function(){return o(this,function(n){switch(n.label){case 0:return[4,nr(!0)];case 1:n.sent();return[2]}})}))];case 1:n.sent();return[2]}})});return nl.apply(this,arguments)}function nf(){return np.apply(this,arguments)}function np(){np=e(function(){return o(this,function(n){switch(n.label){case 0:return[4,B("npx @eslint/config-inspector","Lint inspect processing...")];case 1:n.sent();return[2]}})});return np.apply(this,arguments)}function nh(){return nd.apply(this,arguments)}function nd(){nd=e(function(){return o(this,function(n){switch(n.label){case 0:J("Starting lint-staged process for ".concat(O.default.env.INIT_CWD),"\uD83D\uDE80");return[4,$("Running lint-staged...",/*#__PURE__*/e(function(){return o(this,function(n){switch(n.label){case 0:q.length=0;return[4,Promise.all([ne(),nc()])];case 1:n.sent(),nn();return[2]}})}))];case 1:n.sent();return[2]}})});return nd.apply(this,arguments)}function ng(){return ny.apply(this,arguments)}function ny(){ny=e(function(){return o(this,function(n){switch(n.label){case 0:J("Starting commitlint process for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Running commitlint...",/*#__PURE__*/e(function(){var n,e;return o(this,function(t){switch(t.label){case 0:q.length=0;n=S.resolve(k,"./configs/commitlint/commitlint.base.js"),e="npx --no -- commitlint --edit ".concat(K.GIT_COMMIT_MSG," --config ").concat(n);return[4,B(e,"Commitlint processing...")];case 1:t.sent(),nn();return[2]}})}))];case 1:n.sent();return[2]}})});return ny.apply(this,arguments)}function nm(){return nb.apply(this,arguments)}function nb(){nb=e(function(){var n;return o(this,function(e){switch(e.label){case 0:n=I.existsSync(K.HUSKY_PATH);if(!n)return[3,2];return[4,B("npx rimraf ".concat(K.HUSKY_PATH," ").concat(K.GIT_HOOK_PATH," && git config core.hooksPath ").concat(K.GIT_HOOK_PATH),"Removing husky hooks...")];case 1:n=e.sent();e.label=2;case 2:n,I.writeFileSync(K.SIMPLE_GIT_HOOKS_PATH,JSON.stringify({"pre-commit":'\n                    echo "\uD83D\uDE80 Running build before commit..."\n                    npm run build || (echo "❌ Build failed – aborting commit." && exit 1)\n\n                    echo "✅ Build successful – running lint..."\n                    npx --yes cyberskill lint-staged || (echo "❌ Lint failed – aborting commit." && exit 1)\n                ',"commit-msg":"npx --yes cyberskill commitlint"},null,4));return[4,B("npx simple-git-hooks","Setting up git hooks...")];case 3:e.sent(),I.unlinkSync(K.SIMPLE_GIT_HOOKS_PATH);return[2]}})});return nb.apply(this,arguments)}function n_(){var n="".concat(K.INIT_CWD,"/package.json");return JSON.parse(I.readFileSync(n,"utf-8")).name===K.PACKAGE_NAME}function nv(){return nw.apply(this,arguments)}function nw(){nw=e(function(){return o(this,function(n){switch(n.label){case 0:J("Starting setup process for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Setting up...",/*#__PURE__*/e(function(){var n,i,s,u,a,l,f,p,h;return o(this,function(d){switch(d.label){case 0:i="".concat(K.INIT_CWD,"/package.json"),s=/*#__PURE__*/function(){var n=e(function(){return o(this,function(n){switch(n.label){case 0:return[4,(0,v.default)("https://registry.npmjs.org/".concat(K.PACKAGE_NAME,"/latest"))];case 1:return[4,n.sent().json()];case 2:return[2,n.sent().version]}})});return function e(){return n.apply(this,arguments)}}(),u=/*#__PURE__*/function(){var n=e(function(){var n,e,t,r;return o(this,function(i){switch(i.label){case 0:return[4,s()];case 1:n=i.sent();try{e="".concat(K.INIT_CWD,"/node_modules/").concat(K.PACKAGE_NAME,"/package.json"),t=JSON.parse(I.readFileSync(e,"utf-8")),r=t.version;return[2,r!==n]}catch(n){return[2,!0]}return[2]}})});return function e(){return n.apply(this,arguments)}}(),a=/*#__PURE__*/function(){var n=e(function(){var n,e;return o(this,function(o){switch(o.label){case 0:return[4,s()];case 1:n=o.sent(),e=JSON.parse(I.readFileSync(i,"utf-8"));e.dependencies=c(r({},e.dependencies),t({},K.PACKAGE_NAME,n)),I.writeFileSync(i,JSON.stringify(e,null,2));return[4,B("npm i -f","Installing all dependencies with updated cyberskill...")];case 2:o.sent();return[4,B("npm run lint:fix","Fixing lint issues...")];case 3:o.sent();return[2]}})});return function e(){return n.apply(this,arguments)}}(),l=JSON.parse(I.readFileSync(i,"utf-8"));if(!n_())return[3,1];f=J("Cyberskill is the current project. No setup needed.","✅");return[3,7];case 1:h=!((n=l.dependencies)===null||n===void 0?void 0:n.cyberskill);if(h)return[3,3];return[4,u()];case 2:h=d.sent();d.label=3;case 3:if(!h)return[3,5];J("Cyberskill is missing or outdated. Updating...");return[4,a()];case 4:p=d.sent();return[3,6];case 5:p=J("Cyberskill is up to date","✅");d.label=6;case 6:f=p;d.label=7;case 7:f,nm();return[2]}})}))];case 1:n.sent();return[2]}})});return nw.apply(this,arguments)}function nI(){return nS.apply(this,arguments)}function nS(){nS=e(function(){return o(this,function(n){switch(n.label){case 0:J("Starting reset process for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Resetting...",/*#__PURE__*/e(function(){return o(this,function(n){switch(n.label){case 0:return[4,B("npx rimraf ".concat(K.INIT_CWD,"/node_modules ").concat(K.INIT_CWD,"/package-lock.json"),"Cleaning node_modules and package-lock.json...")];case 1:n.sent();return[4,B("npm i -f","Installing all dependencies...")];case 2:n.sent(),nm();return[2]}})}))];case 1:n.sent();return[2]}})});return nS.apply(this,arguments)}function nO(){return nT.apply(this,arguments)}function nT(){nT=e(function(){var n;return o(this,function(t){switch(t.label){case 0:n=S.resolve(k,"./configs/vitest/react/unit.js");J("Starting unit tests for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Running unit tests...",/*#__PURE__*/e(function(){return o(this,function(e){switch(e.label){case 0:return[4,B("npx vitest --config ".concat(n),"Running unit tests...")];case 1:e.sent();return[2]}})}))];case 1:t.sent();return[2]}})});return nT.apply(this,arguments)}function nP(){return nN.apply(this,arguments)}function nN(){nN=e(function(){var n;return o(this,function(t){switch(t.label){case 0:n=S.resolve(k,"./configs/vitest/react/e2e.js");J("Starting e2e tests for ".concat(K.INIT_CWD),"\uD83D\uDE80");return[4,$("Running end-to-end tests...",/*#__PURE__*/e(function(){return o(this,function(e){switch(e.label){case 0:return[4,B("npx vitest --config ".concat(n),"Running e2e tests...")];case 1:e.sent();return[2]}})}))];case 1:t.sent();return[2]}})});return nN.apply(this,arguments)}(0,x.default)((0,N.hideBin)(O.default.argv)).command("lint","Run linting checks",no).command("lint:fix","Fix linting and formatting issues",na).command("lint:inspect","Inspect linting rules",nf).command("lint-staged","Run lint-staged with given configuration",nh).command("commitlint","Run commitlint with given configuration",ng).command("setup","Run setup with given configuration",nv).command("reset","Reset dependencies and install",nI).command("test:unit","Run unit tests",nO).command("test:e2e","Run e2e tests",nP).help().parse();